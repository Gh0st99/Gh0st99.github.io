---
layout: post
title:  "DDIA 笔记"
date:   2021-04-06 12:27:49 +0800
categories: Architecture
---

# DDIA 笔记

## 可靠性，可扩展性，可维护性

### 可靠性

**“即使出现问题，也能继续正确工作”**

- 原因：故障（`fault`）系统的一部分状态偏离其标准；、
  - 硬件故障（`hardware faults`）随机的、相互独立的；
  - 软件错误（`systematic error`）
  - 人为错误
- 应对：容错（`fault-tolerant`）或韧性（`resilient`）。

### 可扩展性

**描述系统应对负载增长能力**。

负载：用负载参数（`load parameters`）的数字来描述。
- `qps`;
- IO R/W rate;
- 活跃用户数量；
- 缓存命中率等。

当**负载增加**会发生什么：
- **增加负载参数**并**保持系统资源**（CPU、内存、网络带宽等）不变时，系统性能将受到什么影响？
- **增加负载参数**并**希望保持性能不变**时，需要**增加多少系统资源**？

上面问题需要性能数据：
- 吞吐量（`throughput`）；
  - 每秒可以处理的记录数量；
  - 在特定规模数据集上运行作业的总时间。
- 响应时间（`response time`）客户端发送请求到接收响应之间的时间。
  - vs. 延迟
    - 延迟(`latency`): 请求等待处理的持续时长，休眠状态，等待服务；
    - 响应时间 = 服务时间（`service time`） + 网络延迟 + 排队延迟。
  - 可以测量的数值分布（`distribution`）
    - 中位数, p50;
    - p95
    - p99
    - p999
    - 尾部延迟（tail latencies），非常重要。最有价值客户。

应对负载增长：
- 纵向扩展（`scaling up`）
- 横向扩展（`scaling out`）

### 可维护性

---

## 数据模型与查询语言

层层叠加的数据模型构建多数应用。

每层数据模型的关键问题：**如何用低一层数据来表示**。

- App Dev: 观察世界次啊用对象或数据结构，一起相应 API 建模；
- 存储数据结构：用通用数据模型，`JSON` 或 `XML` 或 `ER` 中的表以及图模型；
- DB Dev: 如何以内存、磁盘或网络上的字节来表示数据；
- 硬件工程师: 电流，光脉冲，磁场或者其他东西来表示字节。

**每个层**都通过**提供一个明确的数据模型来隐藏更低层次中的复杂性**。

### 关系型

数据被组织成**关系**（表），其中每个关系是**元组**（SQL中称作行)的无序集合。

用于：典型的**事务处理**和**批处理**。

#### 阻抗不匹配（impedance mismatch）

大多数应用程序开发都使用面向对象的编程语言来开发，用来转化数据表示和关系数据库元组的代码很冗繁，执行时也有不少耗时。这种**应用程序和数据库表示信息的模式之间的不匹配**有时也被称为`impedance mismatch`。

`ORM` 能**减轻**所需的代码数量。

![bill-gates-linkedin]({{ site.url }}/assets/imgs/ddia/bill-gates.png)

这里使用 `user_id` 作为标识。一对多的关系表示为：
- 单独的表中(`positions`)，对 `User` 表提供外键引用；
- 结构化 `JSON` 或 `XML` 存于列中；
- 直接 `JSON` 文档表示。
  - 更好的局部性，所有的相关信息再一个地方，一个查询足够；
  - 一对多隐含了树状结构，`JSON` 使得这个结构明确。

![one-to-many-json-tree]({{ site.url }}/assets/imgs/ddia/one-to-many-json-tree.png)

### NoSQL

- 更好的可扩展性；
- 免费和开源；
- 关系模型不能很好地支持一些特殊的查询操作；
- 更具多动态性与表现力的数据模型。