<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1104px" preserveAspectRatio="none" style="width:1434px;height:1104px;background:#FFFFFF;" version="1.1" viewBox="0 0 1434 1104" width="1434px" zoomAndPan="magnify"><defs><filter height="300%" id="f1arh8efzpq1oy" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FEFECE" filter="url(#f1arh8efzpq1oy)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="77" x="10" y="533.1602"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="20" y="556.1553">Network</text><rect fill="#FEFECE" filter="url(#f1arh8efzpq1oy)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="74" x="137" y="436.0469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54" x="147" y="459.042">tcp/udp</text><rect fill="#FEFECE" filter="url(#f1arh8efzpq1oy)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="108" x="261" y="20"/><a href="https://draveness.me/whys-the-design-tcp-three-way-handshake/" target="_top" title="https://draveness.me/whys-the-design-tcp-three-way-handshake/" xlink:actuate="onRequest" xlink:href="https://draveness.me/whys-the-design-tcp-three-way-handshake/" xlink:show="new" xlink:title="https://draveness.me/whys-the-design-tcp-three-way-handshake/" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="88" x="271" y="42.9951">TCP 三次握手</text></a><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="422" y="33.8467">流程</text><path d="M369,38.1484 L379,38.1484 C394,38.1484 394,29 409,29 L419,29 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><a href="https://www.zhihu.com/question/361111920/answer/1199952447" target="_top" title="https://www.zhihu.com/question/361111920/answer/1199952447" xlink:actuate="onRequest" xlink:href="https://www.zhihu.com/question/361111920/answer/1199952447" xlink:show="new" xlink:title="https://www.zhihu.com/question/361111920/answer/1199952447" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="52" x="422" y="52.1436">65535?</text></a><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="151" x="478" y="52.1436">最多建立多少个连接？ *</text><path d="M369,38.1484 L379,38.1484 C394,38.1484 394,47.2969 409,47.2969 L419,47.2969 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M211,454.1953 L221,454.1953 C236,454.1953 236,38.1484 251,38.1484 L261,38.1484 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="264" y="80.292">tcp、udp 区别</text><path d="M211,454.1953 L221,454.1953 C236,454.1953 236,75.4453 251,75.4453 L261,75.4453 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1arh8efzpq1oy)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="76" x="261" y="103.0391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="271" y="126.0342">报文结构</text><rect fill="#FEFECE" filter="url(#f1arh8efzpq1oy)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="50" x="387" y="103.0391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30" x="397" y="126.0342">UDP</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="490" y="98.5889">源端口</text><path d="M437,121.1875 L447,121.1875 C462,121.1875 462,93.7422 477,93.7422 L487,93.7422 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="490" y="116.8857">目的端口</text><path d="M437,121.1875 L447,121.1875 C462,121.1875 462,112.0391 477,112.0391 L487,112.0391 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="490" y="135.1826">长度</text><path d="M437,121.1875 L447,121.1875 C462,121.1875 462,130.3359 477,130.3359 L487,130.3359 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="490" y="153.4795">校验码</text><path d="M437,121.1875 L447,121.1875 C462,121.1875 462,148.6328 477,148.6328 L487,148.6328 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M337,121.1875 L347,121.1875 C362,121.1875 362,121.1875 377,121.1875 L387,121.1875 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M211,454.1953 L221,454.1953 C236,454.1953 236,121.1875 251,121.1875 L261,121.1875 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1arh8efzpq1oy)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="80" x="261" y="240.9688"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60" x="271" y="263.9639">TCP 粘包</text><rect fill="#FEFECE" filter="url(#f1arh8efzpq1oy)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="80" x="391" y="212.8203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60" x="401" y="235.8154">TCP 特性</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="140" x="524" y="171.7764">面向连接的、可靠的、</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="70" x="664" y="171.7764">基于字节流</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="734" y="171.7764">（没有</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="line-through" textLength="90" x="776" y="171.7764">消息 &amp; 数据包</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="126" x="866" y="171.7764">）的传输层通信协议</text><path d="M471,230.9688 L481,230.9688 C496,230.9688 496,166.9297 511,166.9297 L521,166.9297 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="line-through" textLength="182" x="524" y="190.0732">以消息为单位向目的主机传输</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="266" x="706" y="190.0732">，数据组合成一个数据段发送给目标的主机</text><path d="M471,230.9688 L481,230.9688 C496,230.9688 496,185.2266 511,185.2266 L521,185.2266 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1arh8efzpq1oy)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="59" x="521" y="231.1172"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="531" y="254.1123">Nagle</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="308" x="633" y="208.3701">小的数据块在本地缓冲区中等待更多待发送的数据</text><path d="M580,249.2656 L590,249.2656 C605,249.2656 605,203.5234 620,203.5234 L630,203.5234 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="434" x="633" y="226.667">数据写入 TCP 缓冲区，待缓冲区 &gt; MSS 或者上一个数据被 ACK 发送</text><path d="M580,249.2656 L590,249.2656 C605,249.2656 605,221.8203 620,221.8203 L630,221.8203 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86" x="633" y="244.9639">用于：Telnet</text><path d="M580,249.2656 L590,249.2656 C605,249.2656 605,240.1172 620,240.1172 L630,240.1172 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="162" x="633" y="263.2607">TCP_NODELAY = 1 关闭</text><path d="M580,249.2656 L590,249.2656 C605,249.2656 605,258.4141 620,258.4141 L630,258.4141 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="518" x="633" y="281.5576">优点：数据包较小时提高网络带宽的利用率并减少 TCP 和 IP 协议头带来的额外开销</text><path d="M580,249.2656 L590,249.2656 C605,249.2656 605,276.7109 620,276.7109 L630,276.7109 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="336" x="633" y="299.8545">缺点：应用层协议多次写入的数据被合并或者拆分发送</text><path d="M580,249.2656 L590,249.2656 C605,249.2656 605,295.0078 620,295.0078 L630,295.0078 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M471,230.9688 L481,230.9688 C496,230.9688 496,249.2656 511,249.2656 L521,249.2656 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M341,259.1172 L351,259.1172 C366,259.1172 366,230.9688 381,230.9688 L391,230.9688 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1arh8efzpq1oy)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="258" x="391" y="314.1563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="238" x="401" y="337.1514">解决：自己设计消息的边界（消息帧）</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="196" x="702" y="328.0029">长度： HTTP Content-Length</text><path d="M649,332.3047 L659,332.3047 C674,332.3047 674,323.1563 689,323.1563 L699,323.1563 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="316" x="702" y="346.2998">终结符: HTTP Chunked 中负载大小为 0 作为边界</text><path d="M649,332.3047 L659,332.3047 C674,332.3047 674,341.4531 689,341.4531 L699,341.4531 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M341,259.1172 L351,259.1172 C366,259.1172 366,332.3047 381,332.3047 L391,332.3047 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M211,454.1953 L221,454.1953 C236,454.1953 236,259.1172 251,259.1172 L261,259.1172 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1arh8efzpq1oy)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="102" x="261" y="461.3828"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82" x="271" y="484.3779">tcp 四次挥手</text><rect fill="#FEFECE" filter="url(#f1arh8efzpq1oy)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="250" x="413" y="461.3828"/><a href="https://draveness.me/whys-the-design-tcp-time-wait" target="_top" title="https://draveness.me/whys-the-design-tcp-time-wait" xlink:actuate="onRequest" xlink:href="https://draveness.me/whys-the-design-tcp-time-wait" xlink:show="new" xlink:title="https://draveness.me/whys-the-design-tcp-time-wait" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="230" x="423" y="484.3779">为什么 TCP 协议有 TIME_WAIT 状态</text></a><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="568" x="716" y="374.4482">防止延迟的数据段被其他使用相同源地址、源端口、目的地址以及目的端口的 TCP 连接收到</text><path d="M663,479.5313 L673,479.5313 C688,479.5313 688,369.6016 703,369.6016 L713,369.6016 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1arh8efzpq1oy)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="224" x="713" y="395.1953"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="204" x="723" y="418.1904">保证 TCP 连接的远程被正确关闭</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="317" x="990" y="392.7451">等待被动关闭连接的一方收到 FIN 对应的 ACK 消息</text><path d="M937,413.3438 L947,413.3438 C962,413.3438 962,387.8984 977,387.8984 L987,387.8984 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="994" y="411.042"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="256" x="990" y="427.3389">服务端没收到 ACK，客户端重新与服务端</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="270" x="990" y="443.6357">建立连接，认为连接合法，握手会收到 RST</text><path d="M937,413.3438 L947,413.3438 C962,413.3438 962,422.4922 977,422.4922 L987,422.4922 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M663,479.5313 L673,479.5313 C688,479.5313 688,413.3438 703,413.3438 L713,413.3438 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1arh8efzpq1oy)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="48" x="713" y="505.125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="723" y="528.1201">调优</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="818" y="461.9326"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="262" x="814" y="478.2295">SO_LINGER 设置暂存时间 l_linger 为 0，</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="218" x="814" y="494.5264">关闭 TCP 连接，内核就会直接丢弃</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="196" x="814" y="510.8232">缓冲区中的全部数据并向服务端</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="218" x="814" y="527.1201">发送 RST 消息直接终止当前的连接</text><path d="M761,523.2734 L771,523.2734 C786,523.2734 786,489.6797 801,489.6797 L811,489.6797 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="818" y="545.417"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="275" x="814" y="561.7139">net.ipv4.tcp_tw_reuse  TCP 的时间戳选项</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="300" x="814" y="578.0107">允许内核重用处于 TIME_WAIT 状态的 TCP 连接</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="818" y="594.3076"/><path d="M761,523.2734 L771,523.2734 C786,523.2734 786,565.0156 801,565.0156 L811,565.0156 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M663,479.5313 L673,479.5313 C688,479.5313 688,523.2734 703,523.2734 L713,523.2734 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M363,479.5313 L373,479.5313 C388,479.5313 388,479.5313 403,479.5313 L413,479.5313 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M211,454.1953 L221,454.1953 C236,454.1953 236,479.5313 251,479.5313 L261,479.5313 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1arh8efzpq1oy)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="108" x="261" y="636.7578"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="271" y="659.7529">TCP 拆分数据</text><rect fill="#FEFECE" filter="url(#f1arh8efzpq1oy)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="181" x="419" y="608.6094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="161" x="429" y="631.6045">TCP(Segment) 传输性能</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="653" y="613.3076">不会以</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="line-through" textLength="168" x="695" y="613.3076">消息为单位向目的主机发送</text><path d="M600,626.7578 L610,626.7578 C625,626.7578 625,608.4609 640,608.4609 L650,608.4609 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="385" x="653" y="631.6045">MSS(Max segment size) 正常： MTU - 40；默认 536 Byte</text><path d="M600,626.7578 L610,626.7578 C625,626.7578 625,626.7578 640,626.7578 L650,626.7578 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="146" x="653" y="649.9014">MSS 确定的是内核层面</text><path d="M600,626.7578 L610,626.7578 C625,626.7578 625,645.0547 640,645.0547 L650,645.0547 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M369,654.9063 L379,654.9063 C394,654.9063 394,626.7578 409,626.7578 L419,626.7578 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1arh8efzpq1oy)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="177" x="419" y="664.9063"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="157" x="429" y="687.9014">IP(Packet) 物理设备限制</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="114" x="649" y="678.7529">IP 提供路由和寻址</text><path d="M596,683.0547 L606,683.0547 C621,683.0547 621,673.9063 636,673.9063 L646,673.9063 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="320" x="649" y="697.0498">不同设置间传输确定 MTU(Max transmission unit)</text><path d="M596,683.0547 L606,683.0547 C621,683.0547 621,692.2031 636,692.2031 L646,692.2031 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M369,654.9063 L379,654.9063 C394,654.9063 394,683.0547 409,683.0547 L419,683.0547 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M211,454.1953 L221,454.1953 C236,454.1953 236,654.9063 251,654.9063 L261,654.9063 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1arh8efzpq1oy)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="108" x="261" y="786.6484"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="271" y="809.6436">TCP 性能问题</text><rect fill="#FEFECE" filter="url(#f1arh8efzpq1oy)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="272" x="419" y="730.3516"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="252" x="429" y="753.3467">拥塞控制算法会在丢包时主动降低吞吐量</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="412" x="744" y="725.1982">线増积减（Additive increase/multiplicative decrease，AIMD）</text><path d="M691,748.5 L701,748.5 C716,748.5 716,720.3516 731,720.3516 L741,720.3516 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1arh8efzpq1oy)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="326" x="741" y="739.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="306" x="751" y="762.4951">维护一个拥塞控制窗口（Congestion Window）</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="266" x="1120" y="744.1982">决定了发送方同时能向接收方发送多少数据</text><path d="M1067,757.6484 L1077,757.6484 C1092,757.6484 1092,739.3516 1107,739.3516 L1117,739.3516 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="126" x="1120" y="762.4951">防止发送方向接收方</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="line-through" textLength="98" x="1246" y="762.4951">发送了太多数据</text><path d="M1067,757.6484 L1077,757.6484 C1092,757.6484 1092,757.6484 1107,757.6484 L1117,757.6484 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="218" x="1120" y="780.792">防止 TCP 连接的任意一方向网络中</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="line-through" textLength="84" x="1338" y="780.792">发送大量数据</text><path d="M1067,757.6484 L1077,757.6484 C1092,757.6484 1092,775.9453 1107,775.9453 L1117,775.9453 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M691,748.5 L701,748.5 C716,748.5 716,757.6484 731,757.6484 L741,757.6484 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M369,804.7969 L379,804.7969 C394,804.7969 394,748.5 409,748.5 L419,748.5 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1arh8efzpq1oy)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="286" x="419" y="795.7969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="266" x="429" y="818.792">三次握手增加了数据传输的延迟和额外开销</text><rect fill="#FEFECE" filter="url(#f1arh8efzpq1oy)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="153" x="755" y="795.7969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="133" x="765" y="818.792">额外开销是 222 字节</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="214" x="961" y="800.4951">以太网数据帧占 3 * 14 = 42 字节</text><path d="M908,813.9453 L918,813.9453 C933,813.9453 933,795.6484 948,795.6484 L958,795.6484 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="188" x="961" y="818.792">IP 数据帧占 3 * 20 = 60 字节</text><path d="M908,813.9453 L918,813.9453 C933,813.9453 933,813.9453 948,813.9453 L958,813.9453 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="165" x="961" y="837.0889">TCP 数据帧约占 120 字节</text><path d="M908,813.9453 L918,813.9453 C933,813.9453 933,832.2422 948,832.2422 L958,832.2422 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M705,813.9453 L715,813.9453 C730,813.9453 730,813.9453 745,813.9453 L755,813.9453 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M369,804.7969 L379,804.7969 C394,804.7969 394,813.9453 409,813.9453 L419,813.9453 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1arh8efzpq1oy)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="230" x="419" y="852.0938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="210" x="429" y="875.0889">累计应答机制导致了数据段的传输</text><path d="M369,804.7969 L379,804.7969 C394,804.7969 394,870.2422 409,870.2422 L419,870.2422 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M211,454.1953 L221,454.1953 C236,454.1953 236,804.7969 251,804.7969 L261,804.7969 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M87,551.3086 L97,551.3086 C112,551.3086 112,454.1953 127,454.1953 L137,454.1953 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1arh8efzpq1oy)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="48" x="137" y="940.7617"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="147" y="963.7568">http</text><rect fill="#FEFECE" filter="url(#f1arh8efzpq1oy)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="62" x="235" y="908.3906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="245" y="931.3857">请求头</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="50" x="350" y="922.2373">expire</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="298" x="400" y="922.2373">: 包含日期/时间， 即在此时候之后，响应过期。</text><path d="M297,926.5391 L307,926.5391 C322,926.5391 322,917.3906 337,917.3906 L347,917.3906 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="109" x="350" y="940.5342">cache-control</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93" x="459" y="940.5342">: 实现缓存机制</text><path d="M297,926.5391 L307,926.5391 C322,926.5391 322,935.6875 337,935.6875 L347,935.6875 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M185,958.9102 L195,958.9102 C210,958.9102 210,926.5391 225,926.5391 L235,926.5391 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1arh8efzpq1oy)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="62" x="235" y="964.6875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="245" y="987.6826">状态码</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="30" x="350" y="960.2373">301</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="265" x="384" y="960.2373">永久重定向到由 Location 头部指定的url上</text><path d="M297,982.8359 L307,982.8359 C322,982.8359 322,955.3906 337,955.3906 L347,955.3906 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="30" x="350" y="978.5342">302</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="293" x="384" y="978.5342">暂时的移动到了由Location 头部指定的 URL 上</text><path d="M297,982.8359 L307,982.8359 C322,982.8359 322,973.6875 337,973.6875 L347,973.6875 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="30" x="350" y="996.8311">401</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="238" x="384" y="996.8311">由于缺乏目标资源要求的身份验证凭证</text><path d="M297,982.8359 L307,982.8359 C322,982.8359 322,991.9844 337,991.9844 L347,991.9844 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="30" x="350" y="1015.1279">403</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="294" x="384" y="1015.1279">服务器端有能力处理该请求，但是拒绝授权访问</text><path d="M297,982.8359 L307,982.8359 C322,982.8359 322,1010.2813 337,1010.2813 L347,1010.2813 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M185,958.9102 L195,958.9102 C210,958.9102 210,982.8359 225,982.8359 L235,982.8359 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M87,551.3086 L97,551.3086 C112,551.3086 112,958.9102 127,958.9102 L137,958.9102 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1arh8efzpq1oy)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="56" x="137" y="1037.875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="36" x="147" y="1060.8701">https</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="246" y="1033.4248">原理</text><path d="M193,1056.0234 L203,1056.0234 C218,1056.0234 218,1028.5781 233,1028.5781 L243,1028.5781 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="246" y="1051.7217">数字签名</text><path d="M193,1056.0234 L203,1056.0234 C218,1056.0234 218,1046.875 233,1046.875 L243,1046.875 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="246" y="1070.0186">数字证书</text><path d="M193,1056.0234 L203,1056.0234 C218,1056.0234 218,1065.1719 233,1065.1719 L243,1065.1719 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98" x="246" y="1088.3154">非对称加密算法</text><path d="M193,1056.0234 L203,1056.0234 C218,1056.0234 218,1083.4688 233,1083.4688 L243,1083.4688 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M87,551.3086 L97,551.3086 C112,551.3086 112,1056.0234 127,1056.0234 L137,1056.0234 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[aa33bd361c5fa8e0b03bc171ea5f7618]
@startmindmap
* Network
** tcp/udp
*** [[https://draveness.me/whys-the-design-tcp-three-way-handshake/ TCP 三次握手]]
****_ 流程
****_ [[https://www.zhihu.com/question/361111920/answer/1199952447 65535?]] 最多建立多少个连接？ *
***_ tcp、udp 区别
*** 报文结构
**** UDP
*****_ 源端口
*****_ 目的端口
*****_ 长度
*****_ 校验码
*** TCP 粘包
**** TCP 特性
*****_ 面向连接的、可靠的、**基于字节流**（没有<s>消息 & 数据包</s>）的传输层通信协议
*****_ <s>以消息为单位向目的主机传输</s>，数据组合成一个数据段发送给目标的主机
***** Nagle
******_ 小的数据块在本地缓冲区中等待更多待发送的数据
******_ 数据写入 TCP 缓冲区，待缓冲区 > MSS 或者上一个数据被 ACK 发送
******_ 用于：Telnet
******_ TCP_NODELAY = 1 关闭
******_ 优点：数据包较小时提高网络带宽的利用率并减少 TCP 和 IP 协议头带来的额外开销
******_ 缺点：应用层协议多次写入的数据被合并或者拆分发送
**** 解决：自己设计消息的边界（消息帧）
*****_ 长度： HTTP Content-Length
*****_ 终结符: HTTP Chunked 中负载大小为 0 作为边界

*** tcp 四次挥手
**** [[https://draveness.me/whys-the-design-tcp-time-wait 为什么 TCP 协议有 TIME_WAIT 状态]]
*****_ 防止延迟的数据段被其他使用相同源地址、源端口、目的地址以及目的端口的 TCP 连接收到
***** 保证 TCP 连接的远程被正确关闭
******_ 等待被动关闭连接的一方收到 FIN 对应的 ACK 消息
******_: 
服务端没收到 ACK，客户端重新与服务端
建立连接，认为连接合法，握手会收到 RST;
***** 调优
******_: 
SO_LINGER 设置暂存时间 l_linger 为 0，
关闭 TCP 连接，内核就会直接丢弃
缓冲区中的全部数据并向服务端
发送 RST 消息直接终止当前的连接;
******_:
net.ipv4.tcp_tw_reuse  TCP 的时间戳选项
允许内核重用处于 TIME_WAIT 状态的 TCP 连接
;

*** TCP 拆分数据
**** TCP(Segment) 传输性能
*****_ 不会以<s>消息为单位向目的主机发送</s>
*****_ MSS(Max segment size) 正常： MTU - 40；默认 536 Byte
*****_ MSS 确定的是内核层面
**** IP(Packet) 物理设备限制
*****_ IP 提供路由和寻址
*****_ 不同设置间传输确定 MTU(Max transmission unit)

*** TCP 性能问题
**** 拥塞控制算法会在丢包时主动降低吞吐量
*****_ 线増积减（Additive increase/multiplicative decrease，AIMD）
***** 维护一个拥塞控制窗口（Congestion Window）
******_ 决定了发送方同时能向接收方发送多少数据
******_ 防止发送方向接收方<s>发送了太多数据</s>
******_ 防止 TCP 连接的任意一方向网络中<s>发送大量数据</s>
**** 三次握手增加了数据传输的延迟和额外开销
***** 额外开销是 222 字节
******_ 以太网数据帧占 3 * 14 = 42 字节
******_ IP 数据帧占 3 * 20 = 60 字节
******_ TCP 数据帧约占 120 字节
**** 累计应答机制导致了数据段的传输

** http
*** 请求头
****_ **expire**: 包含日期/时间， 即在此时候之后，响应过期。
****_ **cache-control**: 实现缓存机制
*** 状态码
****_ **301** 永久重定向到由 Location 头部指定的url上
****_ **302** 暂时的移动到了由Location 头部指定的 URL 上
****_ **401** 由于缺乏目标资源要求的身份验证凭证
****_ **403** 服务器端有能力处理该请求，但是拒绝授权访问
** https
***_ 原理
***_ 数字签名
***_ 数字证书
***_ 非对称加密算法
@endmindmap

PlantUML version 1.2021.6(Fri May 14 07:09:51 UTC 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>