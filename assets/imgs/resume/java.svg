<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2664px" preserveAspectRatio="none" style="width:1523px;height:2664px;background:#FFFFFF;" version="1.1" viewBox="0 0 1523 2664" width="1523px" zoomAndPan="magnify"><defs><filter height="300%" id="f1hcsaz2ttylea" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FEFECE" filter="url(#f1hcsaz2ttylea)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="46" x="10" y="1313.1836"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="26" x="20" y="1336.1787">Java</text><rect fill="#FEFECE" filter="url(#f1hcsaz2ttylea)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="96" x="106" y="846.2461"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76" x="116" y="869.2412">并发 &amp; 同步</text><rect fill="#FEFECE" filter="url(#f1hcsaz2ttylea)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="182" x="252" y="20"/><a href="https://tech.meituan.com/2018/11/15/java-lock.html" target="_top" title="https://tech.meituan.com/2018/11/15/java-lock.html" xlink:actuate="onRequest" xlink:href="https://tech.meituan.com/2018/11/15/java-lock.html" xlink:show="new" xlink:title="https://tech.meituan.com/2018/11/15/java-lock.html" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="61" x="262" y="42.9951">锁事-美团</text></a><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93" x="327" y="42.9951">synchronized</text><a href="https://xiaomi-info.github.io/2020/03/24/synchronized/" target="_top" title="https://xiaomi-info.github.io/2020/03/24/synchronized/" xlink:actuate="onRequest" xlink:href="https://xiaomi-info.github.io/2020/03/24/synchronized/" xlink:show="new" xlink:title="https://xiaomi-info.github.io/2020/03/24/synchronized/" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="61" x="487" y="33.8467">原理-小米</text></a><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="126" x="548" y="33.8467">，可重入性，可见性</text><path d="M434,38.1484 L444,38.1484 C459,38.1484 459,29 474,29 L484,29 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="487" y="52.1436">锁升级</text><path d="M434,38.1484 L444,38.1484 C459,38.1484 459,47.2969 474,47.2969 L484,47.2969 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M202,864.3945 L212,864.3945 C227,864.3945 227,38.1484 242,38.1484 L252,38.1484 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1hcsaz2ttylea)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="67" x="252" y="76.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47" x="262" y="99.292">volatile</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="372" y="90.1436">可见性</text><path d="M319,94.4453 L329,94.4453 C344,94.4453 344,85.2969 359,85.2969 L369,85.2969 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="372" y="108.4404">内存屏障</text><path d="M319,94.4453 L329,94.4453 C344,94.4453 344,103.5938 359,103.5938 L369,103.5938 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M202,864.3945 L212,864.3945 C227,864.3945 227,94.4453 242,94.4453 L252,94.4453 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1hcsaz2ttylea)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="34" x="252" y="568.4609"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="14" x="262" y="591.4561">锁</text><rect fill="#FEFECE" filter="url(#f1hcsaz2ttylea)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="62" x="336" y="314.1563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="346" y="337.1514">锁升级</text><rect fill="#FEFECE" filter="url(#f1hcsaz2ttylea)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="62" x="448" y="197.0781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="458" y="220.0732">偏向锁</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="140" x="563" y="136.5889">一直被一个线程所访问</text><path d="M510,215.2266 L520,215.2266 C535,215.2266 535,131.7422 550,131.7422 L560,131.7422 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="14" x="563" y="154.8857">在</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="85" x="581" y="154.8857">Mark Word</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="126" x="670" y="154.8857">里存储锁偏向的线程</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="15" x="800" y="154.8857">ID</text><path d="M510,215.2266 L520,215.2266 C535,215.2266 535,150.0391 550,150.0391 L560,150.0391 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="567" y="173.1826"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="28" x="563" y="189.4795">撤销</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="14" x="591" y="189.4795">：</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="238" x="563" y="205.7764">只有遇到其他线程尝试竞争偏向锁时，</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="196" x="563" y="222.0732">持有偏向锁的线程才会释放锁，</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="70" x="563" y="238.3701">不会主动释</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="633" y="238.3701">放偏向锁。</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="98" x="563" y="254.667">等待全局安全点</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="168" x="661" y="254.667">，暂停拥有偏向锁的线程，</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="210" x="563" y="270.9639">判断锁对象是否处于被锁定状态。</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="380" x="563" y="287.2607">恢复无锁（标志位为 01）或轻量级锁（标志位为 00）的状态</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="567" y="303.5576"/><path d="M510,215.2266 L520,215.2266 C535,215.2266 535,233.5234 550,233.5234 L560,233.5234 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M398,332.3047 L408,332.3047 C423,332.3047 423,215.2266 438,215.2266 L448,215.2266 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1hcsaz2ttylea)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="76" x="448" y="397.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="458" y="420.6357">轻量级锁</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="392" x="577" y="321.8545">线程会通过自旋的形式尝试获取锁，不会阻塞，从而提高性能。</text><path d="M524,415.7891 L534,415.7891 C549,415.7891 549,317.0078 564,317.0078 L574,317.0078 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="581" y="340.1514"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61" x="577" y="356.4482">无锁状态:</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="14" x="577" y="372.7451">在</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="98" x="591" y="372.7451">当前线程的栈帧</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98" x="689" y="372.7451">中建立一个名为</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="42" x="787" y="372.7451">锁记录</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="170" x="829" y="372.7451">（Lock Record）的空间，</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="140" x="577" y="389.042">用于存储锁对象目前的</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="85" x="721" y="389.042">Mark Word</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="810" y="389.042">的拷贝，</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="126" x="577" y="405.3389">然后拷贝对象头中的</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="85" x="707" y="405.3389">Mark Word</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="796" y="405.3389">复制到锁记录中。</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="144" x="577" y="421.6357">CAS 操作尝试将对象的</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="85" x="725" y="421.6357">Mark Word</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="814" y="421.6357"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="28" x="814" y="421.6357">更新</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="842" y="421.6357">为指向</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="98" x="888" y="421.6357">Lock Record</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="990" y="421.6357">的指针，</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="577" y="437.9326">并将</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="98" x="609" y="437.9326">Lock Record</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="711" y="437.9326">里的</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="51" x="743" y="437.9326">owner</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98" x="798" y="437.9326">指针指向对象的</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="85" x="900" y="437.9326">Mark Word</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="14" x="985" y="437.9326">。</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="577" y="454.2295">更新</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="28" x="605" y="454.2295">成功</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="330" x="633" y="454.2295">： 线程就拥有了该对象的锁，锁标志位设置为“00”。</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="577" y="470.5264">更新</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="28" x="605" y="470.5264">失败</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="169" x="633" y="470.5264">： 对象的 Mark Word 是否</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="126" x="802" y="470.5264">指向当前线程的栈帧</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="14" x="928" y="470.5264">？</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="196" x="577" y="486.8232">只有当前一个等待线程，自旋；</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="224" x="577" y="503.1201">自旋超过次数，或来第三个，膨胀。</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="581" y="519.417"/><path d="M524,415.7891 L534,415.7891 C549,415.7891 549,424.9375 564,424.9375 L574,424.9375 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M398,332.3047 L408,332.3047 C423,332.3047 423,415.7891 438,415.7891 L448,415.7891 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98" x="451" y="537.7139">重量级锁：管程</text><path d="M398,332.3047 L408,332.3047 C423,332.3047 423,532.8672 438,532.8672 L448,532.8672 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M286,586.6094 L296,586.6094 C311,586.6094 311,332.3047 326,332.3047 L336,332.3047 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="343" y="556.0107"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="28" x="339" y="572.3076">乐观</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="429" x="367" y="572.3076">: 只是在更新数据的时候去判断之前有没有别的线程更新了这个数据，</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="322" x="339" y="588.6045">没有被更新，当前线程将自己修改的数据成功写入。</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="476" x="339" y="604.9014">已经被其他线程更新，则根据不同的实现方式执行不同的操作（报错或重试）</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="343" y="621.1982"/><path d="M286,586.6094 L296,586.6094 C311,586.6094 311,583.7578 326,583.7578 L336,583.7578 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="343" y="639.4951"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="28" x="339" y="655.792">悲观</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="279" x="367" y="655.792">: 使用数据的时候一定有别的线程来修改数据,</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="172" x="339" y="672.0889">在获取数据的时候会先加锁,</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="196" x="339" y="688.3857">确保数据不会被别的线程修改。</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="343" y="704.6826"/><path d="M286,586.6094 L296,586.6094 C311,586.6094 311,667.2422 326,667.2422 L336,667.2422 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1hcsaz2ttylea)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="48" x="336" y="727.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="346" y="750.4248">CAS</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98" x="437" y="722.9795">乐观锁中的重试</text><path d="M384,745.5781 L394,745.5781 C409,745.5781 409,718.1328 424,718.1328 L434,718.1328 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="60" x="437" y="741.2764">ABA问题</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="190" x="497" y="741.2764">: AtomicStampedReference</text><path d="M384,745.5781 L394,745.5781 C409,745.5781 409,736.4297 424,736.4297 L434,736.4297 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="210" x="437" y="759.5732">只能保证一个共享变量的原子操作</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="128" x="647" y="759.5732">: AtomicReference</text><path d="M384,745.5781 L394,745.5781 C409,745.5781 409,754.7266 424,754.7266 L434,754.7266 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="112" x="437" y="777.8701">循环时间长开销大</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="219" x="549" y="777.8701">: 只能保证一个共享变量的原子操作</text><path d="M384,745.5781 L394,745.5781 C409,745.5781 409,773.0234 424,773.0234 L434,773.0234 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M286,586.6094 L296,586.6094 C311,586.6094 311,745.5781 326,745.5781 L336,745.5781 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1hcsaz2ttylea)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="48" x="336" y="852.5078"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="346" y="875.5029">死锁</text><rect fill="#FEFECE" filter="url(#f1hcsaz2ttylea)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="76" x="434" y="800.6172"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="444" y="823.6123">产生条件</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="56" x="563" y="796.167">互斥条件</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="238" x="619" y="796.167">：一个资源每次只能被一个进程使用。</text><path d="M510,818.7656 L520,818.7656 C535,818.7656 535,791.3203 550,791.3203 L560,791.3203 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="70" x="563" y="814.4639">占有且等待</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="378" x="633" y="814.4639">：一个进程因请求资源而阻塞时，对已获得的资源保持不放。</text><path d="M510,818.7656 L520,818.7656 C535,818.7656 535,809.6172 550,809.6172 L560,809.6172 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="84" x="563" y="832.7607">不可强行占有</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="345" x="647" y="832.7607">: 进程已获得的资源，在末使用完之前，不能强行剥夺。</text><path d="M510,818.7656 L520,818.7656 C535,818.7656 535,827.9141 550,827.9141 L560,827.9141 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="84" x="563" y="851.0576">循环等待条件</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="345" x="647" y="851.0576">: 若干进程之间形成一种头尾相接的循环等待资源关系。</text><path d="M510,818.7656 L520,818.7656 C535,818.7656 535,846.2109 550,846.2109 L560,846.2109 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M384,870.6563 L394,870.6563 C409,870.6563 409,818.7656 424,818.7656 L434,818.7656 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1hcsaz2ttylea)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="48" x="434" y="889.1016"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="444" y="912.0967">排查</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="65" x="535" y="869.3545">jstat $PID</text><path d="M482,907.25 L492,907.25 C507,907.25 507,864.5078 522,864.5078 L532,864.5078 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="157" x="535" y="887.6514">jcmd $PID Thread.print</text><path d="M482,907.25 L492,907.25 C507,907.25 507,882.8047 522,882.8047 L532,882.8047 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="539" y="905.9482"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="449" x="535" y="922.2451">ThreadMXBean bean = ManagementFactory.getThreadMXBean()</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="343" x="535" y="938.542">long[] threadIds = bean.findDeadlockedThreads()</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="539" y="954.8389"/><path d="M482,907.25 L492,907.25 C507,907.25 507,925.5469 522,925.5469 L532,925.5469 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M384,870.6563 L394,870.6563 C409,870.6563 409,907.25 424,907.25 L434,907.25 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M286,586.6094 L296,586.6094 C311,586.6094 311,870.6563 326,870.6563 L336,870.6563 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1hcsaz2ttylea)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="112" x="336" y="986.7344"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92" x="346" y="1009.7295">reentrantlock</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="224" x="501" y="973.1357">实现原理，加锁和释放锁的一个过程</text><path d="M448,1004.8828 L458,1004.8828 C473,1004.8828 473,968.2891 488,968.2891 L498,968.2891 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="25" x="501" y="991.4326">aqs</text><path d="M448,1004.8828 L458,1004.8828 C473,1004.8828 473,986.5859 488,986.5859 L498,986.5859 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="501" y="1009.7295">公平和非公平</text><path d="M448,1004.8828 L458,1004.8828 C473,1004.8828 473,1004.8828 488,1004.8828 L498,1004.8828 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="501" y="1028.0264">可重入</text><path d="M448,1004.8828 L458,1004.8828 C473,1004.8828 473,1023.1797 488,1023.1797 L498,1023.1797 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="501" y="1046.3232">可中断</text><path d="M448,1004.8828 L458,1004.8828 C473,1004.8828 473,1041.4766 488,1041.4766 L498,1041.4766 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M286,586.6094 L296,586.6094 C311,586.6094 311,1004.8828 326,1004.8828 L336,1004.8828 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M202,864.3945 L212,864.3945 C227,864.3945 227,586.6094 242,586.6094 L252,586.6094 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1hcsaz2ttylea)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="90" x="252" y="1366.5586"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="262" y="1389.5537">并发工具类</text><rect fill="#FEFECE" filter="url(#f1hcsaz2ttylea)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="160" x="392" y="1162.6641"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="140" x="402" y="1185.6592">concurrenthashmap</text><rect fill="#FEFECE" filter="url(#f1hcsaz2ttylea)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="146" x="602" y="1097.2188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="126" x="612" y="1120.2139">怎么保证线程安全的</text><rect fill="#FEFECE" filter="url(#f1hcsaz2ttylea)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="172" x="798" y="1060.625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="152" x="808" y="1083.6201">HashMap 为什么不安全</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="82" x="1023" y="1074.4717">多线程的put</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="1105" y="1074.4717">可能导致</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="70" x="1161" y="1074.4717">元素的丢失</text><path d="M970,1078.7734 L980,1078.7734 C995,1078.7734 995,1069.625 1010,1069.625 L1020,1069.625 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60" x="1023" y="1092.7686">put和get</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="28" x="1083" y="1092.7686">并发</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="1111" y="1092.7686">时，可能导致</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="68" x="1195" y="1092.7686">get为null</text><path d="M970,1078.7734 L980,1078.7734 C995,1078.7734 995,1087.9219 1010,1087.9219 L1020,1087.9219 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M748,1115.3672 L758,1115.3672 C773,1115.3672 773,1078.7734 788,1078.7734 L798,1078.7734 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1hcsaz2ttylea)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="161" x="798" y="1125.3672"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="141" x="808" y="1148.3623">synchronized + CAS</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="1012" y="1120.917">读安全：使用</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="56" x="1100" y="1120.917">volatile</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="129" x="1160" y="1120.917">保证当 Node 中的值</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="154" x="1289" y="1120.917">变化时对于其他线程可见</text><path d="M959,1143.5156 L969,1143.5156 C984,1143.5156 984,1116.0703 999,1116.0703 L1009,1116.0703 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="1012" y="1139.2139">写安全：使用</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="128" x="1100" y="1139.2139">table 数组的头结点</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="143" x="1228" y="1139.2139">作为 synchronized 的</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="14" x="1371" y="1139.2139">锁</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="1385" y="1139.2139">来保证</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="84" x="1427" y="1139.2139">写操作的安全</text><path d="M959,1143.5156 L969,1143.5156 C984,1143.5156 984,1134.3672 999,1134.3672 L1009,1134.3672 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="214" x="1012" y="1157.5107">写安全：当头结点为 null 时，使用</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="32" x="1230" y="1157.5107">CAS</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="1266" y="1157.5107">操作来</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="140" x="1308" y="1157.5107">保证数据能正确的写入</text><path d="M959,1143.5156 L969,1143.5156 C984,1143.5156 984,1152.6641 999,1152.6641 L1009,1152.6641 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="429" x="1012" y="1175.8076">扩容安全：Synchronized 头节点，标记 moved，再插入的自旋等待</text><path d="M959,1143.5156 L969,1143.5156 C984,1143.5156 984,1170.9609 999,1170.9609 L1009,1170.9609 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M748,1115.3672 L758,1115.3672 C773,1115.3672 773,1143.5156 788,1143.5156 L798,1143.5156 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M552,1180.8125 L562,1180.8125 C577,1180.8125 577,1115.3672 592,1115.3672 L602,1115.3672 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1hcsaz2ttylea)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="173" x="602" y="1190.1094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="153" x="612" y="1213.1045">为什么用 synchronized</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="362" x="828" y="1194.8076">头结点如果使用 ReentrantLock，需继承 AQS，增加内存</text><path d="M775,1208.2578 L785,1208.2578 C800,1208.2578 800,1189.9609 815,1189.9609 L825,1189.9609 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="828" y="1213.1045">降低了锁粒度</text><path d="M775,1208.2578 L785,1208.2578 C800,1208.2578 800,1208.2578 815,1208.2578 L825,1208.2578 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="167" x="828" y="1231.4014">JVM 会优化 synchronized</text><path d="M775,1208.2578 L785,1208.2578 C800,1208.2578 800,1226.5547 815,1226.5547 L825,1226.5547 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M552,1180.8125 L562,1180.8125 C577,1180.8125 577,1208.2578 592,1208.2578 L602,1208.2578 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="605" y="1250.4014">分段锁有什么问题</text><path d="M552,1180.8125 L562,1180.8125 C577,1180.8125 577,1245.5547 592,1245.5547 L602,1245.5547 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1hcsaz2ttylea)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="302" x="602" y="1264.7031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="282" x="612" y="1287.6982">hash算法 (h ^ (h &gt;&gt;&gt; 16)) &amp; HASH_BITS</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="957" y="1278.5498">高位参与</text><path d="M904,1282.8516 L914,1282.8516 C929,1282.8516 929,1273.7031 944,1273.7031 L954,1273.7031 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="189" x="957" y="1296.8467">HASH_BITS 0x7fffffff，变正数</text><path d="M904,1282.8516 L914,1282.8516 C929,1282.8516 929,1292 944,1292 L954,1292 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M552,1180.8125 L562,1180.8125 C577,1180.8125 577,1282.8516 592,1282.8516 L602,1282.8516 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M342,1384.707 L352,1384.707 C367,1384.707 367,1180.8125 382,1180.8125 L392,1180.8125 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1hcsaz2ttylea)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="96" x="392" y="1496.7461"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76" x="402" y="1519.7412">threadlocal</text><rect fill="#FEFECE" filter="url(#f1hcsaz2ttylea)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="132" x="538" y="1321"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="548" y="1343.9951">什么场景下使用的</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="33" x="723" y="1334.8467">MDC</text><path d="M670,1339.1484 L680,1339.1484 C695,1339.1484 695,1330 710,1330 L720,1330 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47" x="723" y="1353.1436">traceid</text><path d="M670,1339.1484 L680,1339.1484 C695,1339.1484 695,1348.2969 710,1348.2969 L720,1348.2969 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M488,1514.8945 L498,1514.8945 C513,1514.8945 513,1339.1484 528,1339.1484 L538,1339.1484 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="424" x="541" y="1381.292">原理： 每个线程有一个自己的ThreadLocalMap&lt;ThreadLocal, V&gt;</text><path d="M488,1514.8945 L498,1514.8945 C513,1514.8945 513,1376.4453 528,1376.4453 L538,1376.4453 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="545" y="1399.5889"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="197" x="541" y="1415.8857">hash冲突怎么办: 开放地址法，</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="266" x="541" y="1432.1826">不为 null，且已经过期，则启动探测试清理</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="545" y="1448.4795"/><path d="M488,1514.8945 L498,1514.8945 C513,1514.8945 513,1419.1875 528,1419.1875 L538,1419.1875 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="541" y="1466.7764">扩容实现</text><path d="M488,1514.8945 L498,1514.8945 C513,1514.8945 513,1461.9297 528,1461.9297 L538,1461.9297 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="442" x="541" y="1485.0732">线程回收： getTask() 返回 null，线程池只是维持引用，防止 JVM 回收</text><path d="M488,1514.8945 L498,1514.8945 C513,1514.8945 513,1480.2266 528,1480.2266 L538,1480.2266 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1hcsaz2ttylea)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="76" x="538" y="1558.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="548" y="1581.4834">核心参数</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90" x="667" y="1503.3701">corePoolSize</text><path d="M614,1576.6367 L624,1576.6367 C639,1576.6367 639,1498.5234 654,1498.5234 L664,1498.5234 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="125" x="667" y="1521.667">maximumPoolSize</text><path d="M614,1576.6367 L624,1576.6367 C639,1576.6367 639,1516.8203 654,1516.8203 L664,1516.8203 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="100" x="667" y="1539.9639">keepAliveTime</text><path d="M614,1576.6367 L624,1576.6367 C639,1576.6367 639,1535.1172 654,1535.1172 L664,1535.1172 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61" x="667" y="1558.2607">TimeUnit</text><path d="M614,1576.6367 L624,1576.6367 C639,1576.6367 639,1553.4141 654,1553.4141 L664,1553.4141 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="195" x="667" y="1576.5576">workQueue: BlockingQueue</text><path d="M614,1576.6367 L624,1576.6367 C639,1576.6367 639,1571.7109 654,1571.7109 L664,1571.7109 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="667" y="1594.8545">threadFactory</text><path d="M614,1576.6367 L624,1576.6367 C639,1576.6367 639,1590.0078 654,1590.0078 L664,1590.0078 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1hcsaz2ttylea)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="427" x="664" y="1609.1563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="407" x="674" y="1632.1514">RejectedExecutionHandler：关闭了或者加不了线程处理了调用</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="310" x="1144" y="1604.7061">AbortPolicy： 抛 RejectedExecutionException</text><path d="M1091,1627.3047 L1101,1627.3047 C1116,1627.3047 1116,1599.8594 1131,1599.8594 L1141,1599.8594 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="113" x="1144" y="1623.0029">CallerRunsPolicy</text><path d="M1091,1627.3047 L1101,1627.3047 C1116,1627.3047 1116,1618.1563 1131,1618.1563 L1141,1618.1563 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="290" x="1144" y="1641.2998">DiscardOldestPolicy：最早的出队，执行这个</text><path d="M1091,1627.3047 L1101,1627.3047 C1116,1627.3047 1116,1636.4531 1131,1636.4531 L1141,1636.4531 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="161" x="1144" y="1659.5967">DiscardPolicy：啥也不做</text><path d="M1091,1627.3047 L1101,1627.3047 C1116,1627.3047 1116,1654.75 1131,1654.75 L1141,1654.75 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M614,1576.6367 L624,1576.6367 C639,1576.6367 639,1627.3047 654,1627.3047 L664,1627.3047 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M488,1514.8945 L498,1514.8945 C513,1514.8945 513,1576.6367 528,1576.6367 L538,1576.6367 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="229" x="541" y="1677.8936">线程数设置： IO密集型和CPU密集型</text><path d="M488,1514.8945 L498,1514.8945 C513,1514.8945 513,1673.0469 528,1673.0469 L538,1673.0469 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="165" x="541" y="1696.1904">参数动态调整后变化过程 *</text><path d="M488,1514.8945 L498,1514.8945 C513,1514.8945 513,1691.3438 528,1691.3438 L538,1691.3438 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="123" x="541" y="1714.4873">线程抛异常怎么办 *</text><path d="M488,1514.8945 L498,1514.8945 C513,1514.8945 513,1709.6406 528,1709.6406 L538,1709.6406 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M342,1384.707 L352,1384.707 C367,1384.707 367,1514.8945 382,1514.8945 L392,1514.8945 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M202,864.3945 L212,864.3945 C227,864.3945 227,1384.707 242,1384.707 L252,1384.707 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M56,1331.332 L66,1331.332 C81,1331.332 81,864.3945 96,864.3945 L106,864.3945 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1hcsaz2ttylea)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="48" x="106" y="1820.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="116" y="1843.9717">线程</text><rect fill="#FEFECE" filter="url(#f1hcsaz2ttylea)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="76" x="204" y="1820.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="214" y="1843.9717">线程状态</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="32" x="333" y="1732.7842">NEW</text><path d="M280,1839.125 L290,1839.125 C305,1839.125 305,1727.9375 320,1727.9375 L330,1727.9375 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75" x="333" y="1751.0811">RUNNABLE</text><path d="M280,1839.125 L290,1839.125 C305,1839.125 305,1746.2344 320,1746.2344 L330,1746.2344 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1hcsaz2ttylea)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="87" x="330" y="1765.3828"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="67" x="340" y="1788.3779">BLOCKED</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="188" x="470" y="1779.2295">等待 montor lock 进入同步区</text><path d="M417,1783.5313 L427,1783.5313 C442,1783.5313 442,1774.3828 457,1774.3828 L467,1774.3828 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="230" x="470" y="1797.5264">Object.wait() 后阻塞重新进入同步区</text><path d="M417,1783.5313 L427,1783.5313 C442,1783.5313 442,1792.6797 457,1792.6797 L467,1792.6797 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M280,1839.125 L290,1839.125 C305,1839.125 305,1783.5313 320,1783.5313 L330,1783.5313 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1hcsaz2ttylea)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="78" x="330" y="1821.6797"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="58" x="340" y="1844.6748">WAITING</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="118" x="461" y="1826.3779">无限 Object.wait()</text><path d="M408,1839.8281 L418,1839.8281 C433,1839.8281 433,1821.5313 448,1821.5313 L458,1821.5313 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="119" x="461" y="1844.6748">无限 Thread.join()</text><path d="M408,1839.8281 L418,1839.8281 C433,1839.8281 433,1839.8281 448,1839.8281 L458,1839.8281 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="121" x="461" y="1862.9717">LockSupport.park</text><path d="M408,1839.8281 L418,1839.8281 C433,1839.8281 433,1858.125 448,1858.125 L458,1858.125 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M280,1839.125 L290,1839.125 C305,1839.125 305,1839.8281 320,1839.8281 L330,1839.8281 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1hcsaz2ttylea)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="129" x="330" y="1894.8672"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109" x="340" y="1917.8623">TIMED_WAITING</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91" x="512" y="1881.2686">Thread.sleep</text><path d="M459,1913.0156 L469,1913.0156 C484,1913.0156 484,1876.4219 499,1876.4219 L509,1876.4219 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="118" x="512" y="1899.5654">有限 Object.wait()</text><path d="M459,1913.0156 L469,1913.0156 C484,1913.0156 484,1894.7188 499,1894.7188 L509,1894.7188 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="119" x="512" y="1917.8623">有限 Thread.join()</text><path d="M459,1913.0156 L469,1913.0156 C484,1913.0156 484,1913.0156 499,1913.0156 L509,1913.0156 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="165" x="512" y="1936.1592">LockSupport.parkNanos</text><path d="M459,1913.0156 L469,1913.0156 C484,1913.0156 484,1931.3125 499,1931.3125 L509,1931.3125 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="151" x="512" y="1954.4561">LockSupport.parkUntil</text><path d="M459,1913.0156 L469,1913.0156 C484,1913.0156 484,1949.6094 499,1949.6094 L509,1949.6094 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M280,1839.125 L290,1839.125 C305,1839.125 305,1913.0156 320,1913.0156 L330,1913.0156 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91" x="333" y="1955.1592">TERMINATED</text><path d="M280,1839.125 L290,1839.125 C305,1839.125 305,1950.3125 320,1950.3125 L330,1950.3125 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M154,1839.125 L164,1839.125 C179,1839.125 179,1839.125 194,1839.125 L204,1839.125 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="207" y="1881.2686">interrupt()</text><path d="M154,1839.125 L164,1839.125 C179,1839.125 179,1876.4219 194,1876.4219 L204,1876.4219 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M56,1331.332 L66,1331.332 C81,1331.332 81,1839.125 96,1839.125 L106,1839.125 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1hcsaz2ttylea)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="48" x="106" y="2204.875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="116" y="2227.8701">集合</text><rect fill="#FEFECE" filter="url(#f1hcsaz2ttylea)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="84" x="204" y="1977.9063"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="214" y="2000.9014">hashmap</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="102" x="341" y="1973.4561">原理, put &amp; get</text><path d="M288,1996.0547 L298,1996.0547 C313,1996.0547 313,1968.6094 328,1968.6094 L338,1968.6094 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="72" x="341" y="1991.7529">8转红黑树?</text><path d="M288,1996.0547 L298,1996.0547 C313,1996.0547 313,1986.9063 328,1986.9063 L338,1986.9063 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="140" x="341" y="2010.0498">什么时候扩容? 0.75？</text><path d="M288,1996.0547 L298,1996.0547 C313,1996.0547 313,2005.2031 328,2005.2031 L338,2005.2031 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="168" x="341" y="2028.3467">扩容步骤，为什么分高低位</text><path d="M288,1996.0547 L298,1996.0547 C313,1996.0547 313,2023.5 328,2023.5 L338,2023.5 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M154,2223.0234 L164,2223.0234 C179,2223.0234 179,1996.0547 194,1996.0547 L204,1996.0547 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1hcsaz2ttylea)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="93" x="204" y="2123.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73" x="214" y="2146.4248">spring aop</text><rect fill="#FEFECE" filter="url(#f1hcsaz2ttylea)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="48" x="347" y="2123.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="357" y="2146.4248">理解</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="452" y="2046.6436"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="385" x="448" y="2062.9404">以不同于 OOP 的方式思考程序结构，模块化的关键是 Aspect</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="472" x="448" y="2079.2373">Aspect 能够实现跨越多种类型和对象的关注点（例如事务管理）的模块化。</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="452" y="2095.5342"/><path d="M395,2141.5781 L405,2141.5781 C420,2141.5781 420,2066.2422 435,2066.2422 L445,2066.2422 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="452" y="2113.8311"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89" x="448" y="2130.1279">解决什么问题:</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="213" x="448" y="2146.4248">1. 提供声明式企业服务（事务）；</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="411" x="448" y="2162.7217">2. 让用户实现自定义 Aspect，以 AOP 补充他们对 OOP 的使用。</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="452" y="2179.0186"/><path d="M395,2141.5781 L405,2141.5781 C420,2141.5781 420,2141.5781 435,2141.5781 L445,2141.5781 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="452" y="2197.3154"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="270" x="448" y="2213.6123">实现原理： 默认（实现了接口）动态代理，</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="292" x="448" y="2229.9092">配置了 Aspect，创建 Bean 时创建代理对象。</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="452" y="2246.2061"/><path d="M395,2141.5781 L405,2141.5781 C420,2141.5781 420,2216.9141 435,2216.9141 L445,2216.9141 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M297,2141.5781 L307,2141.5781 C322,2141.5781 322,2141.5781 337,2141.5781 L347,2141.5781 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M154,2223.0234 L164,2223.0234 C179,2223.0234 179,2141.5781 194,2141.5781 L204,2141.5781 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1hcsaz2ttylea)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="155" x="204" y="2350.3984"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="135" x="214" y="2373.3936">JDK 动态代理 &amp; cglib</text><rect fill="#FEFECE" filter="url(#f1hcsaz2ttylea)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="103" x="409" y="2260.5078"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83" x="419" y="2283.5029">JDK 动态代理</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="309" x="565" y="2265.2061">InvocationHandler &amp; Proxy.newProxyInstance</text><path d="M512,2278.6563 L522,2278.6563 C537,2278.6563 537,2260.3594 552,2260.3594 L562,2260.3594 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="196" x="565" y="2283.5029">优点：原生，生成代理类速度快</text><path d="M512,2278.6563 L522,2278.6563 C537,2278.6563 537,2278.6563 552,2278.6563 L562,2278.6563 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="238" x="565" y="2301.7998">缺点：必须实现接口，反射回调速度慢</text><path d="M512,2278.6563 L522,2278.6563 C537,2278.6563 537,2296.9531 552,2296.9531 L562,2296.9531 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M359,2368.5469 L369,2368.5469 C384,2368.5469 384,2278.6563 399,2278.6563 L409,2278.6563 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1hcsaz2ttylea)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="61" x="409" y="2378.5469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="41" x="419" y="2401.542">CGLIB</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="527" y="2320.7998"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="394" x="523" y="2337.0967">ASM字节码生成框架，直接对需要代理的类的字节码进行操作，</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="364" x="523" y="2353.3936">生成这个类的一个子类，并重写了类的所有可以重写的方法</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="527" y="2369.6904"/><path d="M470,2396.6953 L480,2396.6953 C495,2396.6953 495,2340.3984 510,2340.3984 L520,2340.3984 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1hcsaz2ttylea)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="48" x="520" y="2383.9922"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="530" y="2406.9873">优点</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="621" y="2388.6904">不需要接口</text><path d="M568,2402.1406 L578,2402.1406 C593,2402.1406 593,2383.8438 608,2383.8438 L618,2383.8438 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="210" x="621" y="2406.9873">原来类的子类可以对所有方法代理</text><path d="M568,2402.1406 L578,2402.1406 C593,2402.1406 593,2402.1406 608,2402.1406 L618,2402.1406 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="210" x="621" y="2425.2842">效率高，和编写的普通类没啥区别</text><path d="M568,2402.1406 L578,2402.1406 C593,2402.1406 593,2420.4375 608,2420.4375 L618,2420.4375 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M470,2396.6953 L480,2396.6953 C495,2396.6953 495,2402.1406 510,2402.1406 L520,2402.1406 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1hcsaz2ttylea)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="48" x="520" y="2440.2891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="530" y="2463.2842">缺点</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="137" x="621" y="2444.9873">需要继承，final 类 gg</text><path d="M568,2458.4375 L578,2458.4375 C593,2458.4375 593,2440.1406 608,2440.1406 L618,2440.1406 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="219" x="621" y="2463.2842">重写方法，final 或 private 方法 gg</text><path d="M568,2458.4375 L578,2458.4375 C593,2458.4375 593,2458.4375 608,2458.4375 L618,2458.4375 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="182" x="621" y="2481.5811">操作字节码，代理类生成较慢</text><path d="M568,2458.4375 L578,2458.4375 C593,2458.4375 593,2476.7344 608,2476.7344 L618,2476.7344 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M470,2396.6953 L480,2396.6953 C495,2396.6953 495,2458.4375 510,2458.4375 L520,2458.4375 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M359,2368.5469 L369,2368.5469 C384,2368.5469 384,2396.6953 399,2396.6953 L409,2396.6953 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M154,2223.0234 L164,2223.0234 C179,2223.0234 179,2368.5469 194,2368.5469 L204,2368.5469 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M56,1331.332 L66,1331.332 C81,1331.332 81,2223.0234 96,2223.0234 L106,2223.0234 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1hcsaz2ttylea)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="48" x="106" y="2477.5859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="116" y="2500.5811">反射</text><a href="https://www.cnblogs.com/chanshuyi/p/head_first_of_reflection.html" target="_top" title="https://www.cnblogs.com/chanshuyi/p/head_first_of_reflection.html" xlink:actuate="onRequest" xlink:href="https://www.cnblogs.com/chanshuyi/p/head_first_of_reflection.html" xlink:show="new" xlink:title="https://www.cnblogs.com/chanshuyi/p/head_first_of_reflection.html" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="75" x="207" y="2500.5811">反射-陈树义</text></a><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="282" y="2500.5811">原理</text><path d="M154,2495.7344 L164,2495.7344 C179,2495.7344 179,2495.7344 194,2495.7344 L204,2495.7344 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M56,1331.332 L66,1331.332 C81,1331.332 81,2495.7344 96,2495.7344 L106,2495.7344 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1hcsaz2ttylea)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="44" x="106" y="2533.8828"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="24" x="116" y="2556.8779">NIO</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="203" y="2538.5811">实现原理</text><path d="M150,2552.0313 L160,2552.0313 C175,2552.0313 175,2533.7344 190,2533.7344 L200,2533.7344 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="203" y="2556.8779">优缺点</text><path d="M150,2552.0313 L160,2552.0313 C175,2552.0313 175,2552.0313 190,2552.0313 L200,2552.0313 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="217" x="203" y="2575.1748">netty的设计模型，架构，使用场景</text><path d="M150,2552.0313 L160,2552.0313 C175,2552.0313 175,2570.3281 190,2570.3281 L200,2570.3281 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M56,1331.332 L66,1331.332 C81,1331.332 81,2552.0313 96,2552.0313 L106,2552.0313 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1hcsaz2ttylea)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="76" x="106" y="2597.9219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="116" y="2620.917">引用类型</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="42" x="235" y="2593.4717">强引用</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60" x="277" y="2593.4717">： 强引用</text><path d="M182,2616.0703 L192,2616.0703 C207,2616.0703 207,2588.625 222,2588.625 L232,2588.625 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="42" x="235" y="2611.7686">软引用</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="327" x="277" y="2611.7686">：SoftReference 修饰，在内存要溢出的时候被回收</text><path d="M182,2616.0703 L192,2616.0703 C207,2616.0703 207,2606.9219 222,2606.9219 L232,2606.9219 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="42" x="235" y="2630.0654">弱引用</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="275" x="277" y="2630.0654">：WeakReference，发生 GC，就会被回收</text><path d="M182,2616.0703 L192,2616.0703 C207,2616.0703 207,2625.2188 222,2625.2188 L232,2625.2188 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="42" x="235" y="2648.3623">虚引用</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="260" x="277" y="2648.3623">：PhantomReference，熄火时接到通知</text><path d="M182,2616.0703 L192,2616.0703 C207,2616.0703 207,2643.5156 222,2643.5156 L232,2643.5156 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M56,1331.332 L66,1331.332 C81,1331.332 81,2616.0703 96,2616.0703 L106,2616.0703 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[fd26acfb6f3d7856b488d59693f60c2a]
@startmindmap
* Java

** 并发 & 同步

*** [[https://tech.meituan.com/2018/11/15/java-lock.html 锁事-美团]] synchronized 
****_ [[https://xiaomi-info.github.io/2020/03/24/synchronized/ 原理-小米]]，可重入性，可见性
****_ 锁升级

*** volatile
****_ 可见性
****_ 内存屏障

*** 锁
**** 锁升级
***** 偏向锁
******_ 一直被一个线程所访问
******_ 在 **Mark Word** 里存储锁偏向的线程 **ID**
******_: 
**撤销**：
只有遇到其他线程尝试竞争偏向锁时，
持有偏向锁的线程才会释放锁，
**不会主动释**放偏向锁。
**等待全局安全点**，暂停拥有偏向锁的线程，
判断锁对象是否处于被锁定状态。
恢复无锁（标志位为 01）或轻量级锁（标志位为 00）的状态
;
***** 轻量级锁
******_ 线程会通过自旋的形式尝试获取锁，不会阻塞，从而提高性能。
******_: 
无锁状态: 
在**当前线程的栈帧**中建立一个名为**锁记录**（Lock Record）的空间，
用于存储锁对象目前的 **Mark Word** 的拷贝，
然后拷贝对象头中的 **Mark Word** 复制到锁记录中。
CAS 操作尝试将对象的 **Mark Word** **更新**为指向 **Lock Record** 的指针，
并将 **Lock Record** 里的 **owner** 指针指向对象的 **Mark Word**。
更新**成功**： 线程就拥有了该对象的锁，锁标志位设置为“00”。
更新**失败**： 对象的 Mark Word 是否**指向当前线程的栈帧**？
只有当前一个等待线程，自旋；
自旋超过次数，或来第三个，膨胀。
;
*****_ 重量级锁：管程

****_: 
**乐观**: 只是在更新数据的时候去判断之前有没有别的线程更新了这个数据，
没有被更新，当前线程将自己修改的数据成功写入。
已经被其他线程更新，则根据不同的实现方式执行不同的操作（报错或重试）
;
****_: 
**悲观**: 使用数据的时候一定有别的线程来修改数据,
在获取数据的时候会先加锁,
确保数据不会被别的线程修改。
;
**** CAS
*****_ 乐观锁中的重试
*****_ **ABA问题**: AtomicStampedReference
*****_ **只能保证一个共享变量的原子操作**: AtomicReference
*****_ **循环时间长开销大**: 只能保证一个共享变量的原子操作
**** 死锁
***** 产生条件
******_  **互斥条件**：一个资源每次只能被一个进程使用。
******_ **占有且等待**：一个进程因请求资源而阻塞时，对已获得的资源保持不放。
******_ **不可强行占有**: 进程已获得的资源，在末使用完之前，不能强行剥夺。
******_ **循环等待条件**: 若干进程之间形成一种头尾相接的循环等待资源关系。
***** 排查
******_ jstat $PID
******_ jcmd $PID Thread.print
******_:
ThreadMXBean bean = ManagementFactory.getThreadMXBean()
long[] threadIds = bean.findDeadlockedThreads()
;
**** reentrantlock
*****_ 实现原理，加锁和释放锁的一个过程
*****_ aqs
*****_ 公平和非公平
*****_ 可重入
*****_ 可中断


*** 并发工具类
**** concurrenthashmap
***** 怎么保证线程安全的
****** HashMap 为什么不安全
*******_ **多线程的put**可能导致**元素的丢失**
*******_ put和get**并发**时，可能导致**get为null**
****** synchronized + CAS
*******_ 读安全：使用 **volatile** 保证当 Node 中的值**变化时对于其他线程可见**
*******_ 写安全：使用 **table 数组的头结点**作为 synchronized 的**锁**来保证**写操作的安全**
*******_ 写安全：当头结点为 null 时，使用 **CAS** 操作来**保证数据能正确的写入**
*******_ 扩容安全：Synchronized 头节点，标记 moved，再插入的自旋等待
***** 为什么用 synchronized
******_ 头结点如果使用 ReentrantLock，需继承 AQS，增加内存
******_ 降低了锁粒度
******_ JVM 会优化 synchronized
*****_ 分段锁有什么问题
***** hash算法 (h ^ (h >>> 16)) & HASH_BITS
******_ 高位参与
******_ HASH_BITS 0x7fffffff，变正数

**** threadlocal
***** 什么场景下使用的
******_ MDC
******_ traceid
*****_ 原理： 每个线程有一个自己的ThreadLocalMap<ThreadLocal, V>
*****_: 
hash冲突怎么办: 开放地址法，
不为 null，且已经过期，则启动探测试清理
;
*****_ 扩容实现
*****_ 线程回收： getTask() 返回 null，线程池只是维持引用，防止 JVM 回收
***** 核心参数
******_ corePoolSize
******_ maximumPoolSize
******_ keepAliveTime
******_ TimeUnit
******_ workQueue: BlockingQueue
******_ threadFactory
****** RejectedExecutionHandler：关闭了或者加不了线程处理了调用
*******_ AbortPolicy： 抛 RejectedExecutionException
*******_ CallerRunsPolicy
*******_ DiscardOldestPolicy：最早的出队，执行这个
*******_ DiscardPolicy：啥也不做
*****_ 线程数设置： IO密集型和CPU密集型
*****_ 参数动态调整后变化过程 *
*****_ 线程抛异常怎么办 *

** 线程
*** 线程状态
****_ NEW
****_ RUNNABLE
**** BLOCKED
*****_ 等待 montor lock 进入同步区
*****_ Object.wait() 后阻塞重新进入同步区
**** WAITING
*****_ 无限 Object.wait()
*****_ 无限 Thread.join()
*****_ LockSupport.park
**** TIMED_WAITING
*****_ Thread.sleep
*****_ 有限 Object.wait()
*****_ 有限 Thread.join()
*****_ LockSupport.parkNanos
*****_ LockSupport.parkUntil
****_ TERMINATED

***_ interrupt()

** 集合

*** hashmap
****_ 原理, put & get
****_ 8转红黑树?
****_ 什么时候扩容? 0.75？
****_ 扩容步骤，为什么分高低位
*** spring aop
**** 理解
*****_: 
以不同于 OOP 的方式思考程序结构，模块化的关键是 Aspect
Aspect 能够实现跨越多种类型和对象的关注点（例如事务管理）的模块化。
;
*****_: 
解决什么问题:
1. 提供声明式企业服务（事务）；
2. 让用户实现自定义 Aspect，以 AOP 补充他们对 OOP 的使用。
;
*****_: 
实现原理： 默认（实现了接口）动态代理，
配置了 Aspect，创建 Bean 时创建代理对象。
;
*** JDK 动态代理 & cglib
**** JDK 动态代理
*****_ InvocationHandler & Proxy.newProxyInstance
*****_ 优点：原生，生成代理类速度快
*****_ 缺点：必须实现接口，反射回调速度慢
**** CGLIB
*****_: 
ASM字节码生成框架，直接对需要代理的类的字节码进行操作，
生成这个类的一个子类，并重写了类的所有可以重写的方法
;
***** 优点
******_ 不需要接口
******_  原来类的子类可以对所有方法代理
******_  效率高，和编写的普通类没啥区别
***** 缺点
******_ 需要继承，final 类 gg
******_  重写方法，final 或 private 方法 gg
******_  操作字节码，代理类生成较慢

** 反射
***_ [[https://www.cnblogs.com/chanshuyi/p/head_first_of_reflection.html 反射-陈树义]]原理

** NIO
***_ 实现原理
***_ 优缺点
***_ netty的设计模型，架构，使用场景

** 引用类型
***_ **强引用**： 强引用
***_ **软引用**：SoftReference 修饰，在内存要溢出的时候被回收
***_ **弱引用**：WeakReference，发生 GC，就会被回收
***_ **虚引用**：PhantomReference，熄火时接到通知

@endmindmap

PlantUML version 1.2021.6(Fri May 14 07:09:51 UTC 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>