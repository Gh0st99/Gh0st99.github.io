<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1592px" preserveAspectRatio="none" style="width:2167px;height:1592px;background:#FFFFFF;" version="1.1" viewBox="0 0 2167 1592" width="2167px" zoomAndPan="magnify"><defs><filter height="300%" id="f1n6debg86egv" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FEFECE" filter="url(#f1n6debg86egv)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="46" x="654" y="777.2813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="26" x="664" y="800.2764">Java</text><rect fill="#FEFECE" filter="url(#f1n6debg86egv)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="96" x="750" y="777.2813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76" x="760" y="800.2764">并发 &amp; 同步</text><rect fill="#FEFECE" filter="url(#f1n6debg86egv)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="182" x="896" y="20"/><a href="https://tech.meituan.com/2018/11/15/java-lock.html" target="_top" title="https://tech.meituan.com/2018/11/15/java-lock.html" xlink:actuate="onRequest" xlink:href="https://tech.meituan.com/2018/11/15/java-lock.html" xlink:show="new" xlink:title="https://tech.meituan.com/2018/11/15/java-lock.html" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="61" x="906" y="42.9951">锁事-美团</text></a><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93" x="971" y="42.9951">synchronized</text><a href="https://xiaomi-info.github.io/2020/03/24/synchronized/" target="_top" title="https://xiaomi-info.github.io/2020/03/24/synchronized/" xlink:actuate="onRequest" xlink:href="https://xiaomi-info.github.io/2020/03/24/synchronized/" xlink:show="new" xlink:title="https://xiaomi-info.github.io/2020/03/24/synchronized/" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="61" x="1131" y="33.8467">原理-小米</text></a><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="126" x="1192" y="33.8467">，可重入性，可见性</text><path d="M1078,38.1484 L1088,38.1484 C1103,38.1484 1103,29 1118,29 L1128,29 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="1131" y="52.1436">锁升级</text><path d="M1078,38.1484 L1088,38.1484 C1103,38.1484 1103,47.2969 1118,47.2969 L1128,47.2969 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M846,795.4297 L856,795.4297 C871,795.4297 871,38.1484 886,38.1484 L896,38.1484 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1n6debg86egv)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="67" x="896" y="76.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47" x="906" y="99.292">volatile</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="1016" y="90.1436">可见性</text><path d="M963,94.4453 L973,94.4453 C988,94.4453 988,85.2969 1003,85.2969 L1013,85.2969 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="1016" y="108.4404">内存屏障</text><path d="M963,94.4453 L973,94.4453 C988,94.4453 988,103.5938 1003,103.5938 L1013,103.5938 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M846,795.4297 L856,795.4297 C871,795.4297 871,94.4453 886,94.4453 L896,94.4453 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1n6debg86egv)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="34" x="896" y="568.4609"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="14" x="906" y="591.4561">锁</text><rect fill="#FEFECE" filter="url(#f1n6debg86egv)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="62" x="980" y="314.1563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="990" y="337.1514">锁升级</text><rect fill="#FEFECE" filter="url(#f1n6debg86egv)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="62" x="1092" y="197.0781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="1102" y="220.0732">偏向锁</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="140" x="1207" y="136.5889">一直被一个线程所访问</text><path d="M1154,215.2266 L1164,215.2266 C1179,215.2266 1179,131.7422 1194,131.7422 L1204,131.7422 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="14" x="1207" y="154.8857">在</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="85" x="1225" y="154.8857">Mark Word</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="126" x="1314" y="154.8857">里存储锁偏向的线程</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="15" x="1444" y="154.8857">ID</text><path d="M1154,215.2266 L1164,215.2266 C1179,215.2266 1179,150.0391 1194,150.0391 L1204,150.0391 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="1211" y="173.1826"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="28" x="1207" y="189.4795">撤销</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="14" x="1235" y="189.4795">：</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="238" x="1207" y="205.7764">只有遇到其他线程尝试竞争偏向锁时，</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="196" x="1207" y="222.0732">持有偏向锁的线程才会释放锁，</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="70" x="1207" y="238.3701">不会主动释</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="1277" y="238.3701">放偏向锁。</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="98" x="1207" y="254.667">等待全局安全点</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="168" x="1305" y="254.667">，暂停拥有偏向锁的线程，</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="210" x="1207" y="270.9639">判断锁对象是否处于被锁定状态。</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="380" x="1207" y="287.2607">恢复无锁（标志位为 01）或轻量级锁（标志位为 00）的状态</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="1211" y="303.5576"/><path d="M1154,215.2266 L1164,215.2266 C1179,215.2266 1179,233.5234 1194,233.5234 L1204,233.5234 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1042,332.3047 L1052,332.3047 C1067,332.3047 1067,215.2266 1082,215.2266 L1092,215.2266 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1n6debg86egv)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="76" x="1092" y="397.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="1102" y="420.6357">轻量级锁</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="392" x="1221" y="321.8545">线程会通过自旋的形式尝试获取锁，不会阻塞，从而提高性能。</text><path d="M1168,415.7891 L1178,415.7891 C1193,415.7891 1193,317.0078 1208,317.0078 L1218,317.0078 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="1225" y="340.1514"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61" x="1221" y="356.4482">无锁状态:</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="14" x="1221" y="372.7451">在</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="98" x="1235" y="372.7451">当前线程的栈帧</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98" x="1333" y="372.7451">中建立一个名为</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="42" x="1431" y="372.7451">锁记录</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="170" x="1473" y="372.7451">（Lock Record）的空间，</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="140" x="1221" y="389.042">用于存储锁对象目前的</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="85" x="1365" y="389.042">Mark Word</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="1454" y="389.042">的拷贝，</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="126" x="1221" y="405.3389">然后拷贝对象头中的</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="85" x="1351" y="405.3389">Mark Word</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="1440" y="405.3389">复制到锁记录中。</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="144" x="1221" y="421.6357">CAS 操作尝试将对象的</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="85" x="1369" y="421.6357">Mark Word</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="1458" y="421.6357"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="28" x="1458" y="421.6357">更新</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="1486" y="421.6357">为指向</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="98" x="1532" y="421.6357">Lock Record</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="1634" y="421.6357">的指针，</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="1221" y="437.9326">并将</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="98" x="1253" y="437.9326">Lock Record</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="1355" y="437.9326">里的</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="51" x="1387" y="437.9326">owner</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98" x="1442" y="437.9326">指针指向对象的</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="85" x="1544" y="437.9326">Mark Word</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="14" x="1629" y="437.9326">。</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="1221" y="454.2295">更新</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="28" x="1249" y="454.2295">成功</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="330" x="1277" y="454.2295">： 线程就拥有了该对象的锁，锁标志位设置为“00”。</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="1221" y="470.5264">更新</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="28" x="1249" y="470.5264">失败</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="169" x="1277" y="470.5264">： 对象的 Mark Word 是否</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="126" x="1446" y="470.5264">指向当前线程的栈帧</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="14" x="1572" y="470.5264">？</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="196" x="1221" y="486.8232">只有当前一个等待线程，自旋；</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="224" x="1221" y="503.1201">自旋超过次数，或来第三个，膨胀。</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="1225" y="519.417"/><path d="M1168,415.7891 L1178,415.7891 C1193,415.7891 1193,424.9375 1208,424.9375 L1218,424.9375 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1042,332.3047 L1052,332.3047 C1067,332.3047 1067,415.7891 1082,415.7891 L1092,415.7891 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98" x="1095" y="537.7139">重量级锁：管程</text><path d="M1042,332.3047 L1052,332.3047 C1067,332.3047 1067,532.8672 1082,532.8672 L1092,532.8672 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M930,586.6094 L940,586.6094 C955,586.6094 955,332.3047 970,332.3047 L980,332.3047 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="987" y="556.0107"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="28" x="983" y="572.3076">乐观</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="429" x="1011" y="572.3076">: 只是在更新数据的时候去判断之前有没有别的线程更新了这个数据，</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="322" x="983" y="588.6045">没有被更新，当前线程将自己修改的数据成功写入。</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="476" x="983" y="604.9014">已经被其他线程更新，则根据不同的实现方式执行不同的操作（报错或重试）</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="987" y="621.1982"/><path d="M930,586.6094 L940,586.6094 C955,586.6094 955,583.7578 970,583.7578 L980,583.7578 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="987" y="639.4951"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="28" x="983" y="655.792">悲观</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="279" x="1011" y="655.792">: 使用数据的时候一定有别的线程来修改数据,</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="172" x="983" y="672.0889">在获取数据的时候会先加锁,</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="196" x="983" y="688.3857">确保数据不会被别的线程修改。</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="987" y="704.6826"/><path d="M930,586.6094 L940,586.6094 C955,586.6094 955,667.2422 970,667.2422 L980,667.2422 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1n6debg86egv)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="48" x="980" y="727.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="990" y="750.4248">CAS</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98" x="1081" y="722.9795">乐观锁中的重试</text><path d="M1028,745.5781 L1038,745.5781 C1053,745.5781 1053,718.1328 1068,718.1328 L1078,718.1328 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="60" x="1081" y="741.2764">ABA问题</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="190" x="1141" y="741.2764">: AtomicStampedReference</text><path d="M1028,745.5781 L1038,745.5781 C1053,745.5781 1053,736.4297 1068,736.4297 L1078,736.4297 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="210" x="1081" y="759.5732">只能保证一个共享变量的原子操作</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="128" x="1291" y="759.5732">: AtomicReference</text><path d="M1028,745.5781 L1038,745.5781 C1053,745.5781 1053,754.7266 1068,754.7266 L1078,754.7266 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="112" x="1081" y="777.8701">循环时间长开销大</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="219" x="1193" y="777.8701">: 只能保证一个共享变量的原子操作</text><path d="M1028,745.5781 L1038,745.5781 C1053,745.5781 1053,773.0234 1068,773.0234 L1078,773.0234 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M930,586.6094 L940,586.6094 C955,586.6094 955,745.5781 970,745.5781 L980,745.5781 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1n6debg86egv)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="48" x="980" y="852.5078"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="990" y="875.5029">死锁</text><rect fill="#FEFECE" filter="url(#f1n6debg86egv)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="76" x="1078" y="800.6172"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="1088" y="823.6123">产生条件</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="56" x="1207" y="796.167">互斥条件</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="238" x="1263" y="796.167">：一个资源每次只能被一个进程使用。</text><path d="M1154,818.7656 L1164,818.7656 C1179,818.7656 1179,791.3203 1194,791.3203 L1204,791.3203 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="70" x="1207" y="814.4639">占有且等待</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="378" x="1277" y="814.4639">：一个进程因请求资源而阻塞时，对已获得的资源保持不放。</text><path d="M1154,818.7656 L1164,818.7656 C1179,818.7656 1179,809.6172 1194,809.6172 L1204,809.6172 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="84" x="1207" y="832.7607">不可强行占有</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="345" x="1291" y="832.7607">: 进程已获得的资源，在末使用完之前，不能强行剥夺。</text><path d="M1154,818.7656 L1164,818.7656 C1179,818.7656 1179,827.9141 1194,827.9141 L1204,827.9141 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="84" x="1207" y="851.0576">循环等待条件</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="345" x="1291" y="851.0576">: 若干进程之间形成一种头尾相接的循环等待资源关系。</text><path d="M1154,818.7656 L1164,818.7656 C1179,818.7656 1179,846.2109 1194,846.2109 L1204,846.2109 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1028,870.6563 L1038,870.6563 C1053,870.6563 1053,818.7656 1068,818.7656 L1078,818.7656 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1n6debg86egv)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="48" x="1078" y="889.1016"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="1088" y="912.0967">排查</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="65" x="1179" y="869.3545">jstat $PID</text><path d="M1126,907.25 L1136,907.25 C1151,907.25 1151,864.5078 1166,864.5078 L1176,864.5078 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="157" x="1179" y="887.6514">jcmd $PID Thread.print</text><path d="M1126,907.25 L1136,907.25 C1151,907.25 1151,882.8047 1166,882.8047 L1176,882.8047 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="1183" y="905.9482"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="449" x="1179" y="922.2451">ThreadMXBean bean = ManagementFactory.getThreadMXBean()</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="343" x="1179" y="938.542">long[] threadIds = bean.findDeadlockedThreads()</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="1183" y="954.8389"/><path d="M1126,907.25 L1136,907.25 C1151,907.25 1151,925.5469 1166,925.5469 L1176,925.5469 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1028,870.6563 L1038,870.6563 C1053,870.6563 1053,907.25 1068,907.25 L1078,907.25 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M930,586.6094 L940,586.6094 C955,586.6094 955,870.6563 970,870.6563 L980,870.6563 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1n6debg86egv)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="112" x="980" y="986.7344"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92" x="990" y="1009.7295">reentrantlock</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="224" x="1145" y="973.1357">实现原理，加锁和释放锁的一个过程</text><path d="M1092,1004.8828 L1102,1004.8828 C1117,1004.8828 1117,968.2891 1132,968.2891 L1142,968.2891 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="25" x="1145" y="991.4326">aqs</text><path d="M1092,1004.8828 L1102,1004.8828 C1117,1004.8828 1117,986.5859 1132,986.5859 L1142,986.5859 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="1145" y="1009.7295">公平和非公平</text><path d="M1092,1004.8828 L1102,1004.8828 C1117,1004.8828 1117,1004.8828 1132,1004.8828 L1142,1004.8828 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="1145" y="1028.0264">可重入</text><path d="M1092,1004.8828 L1102,1004.8828 C1117,1004.8828 1117,1023.1797 1132,1023.1797 L1142,1023.1797 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="1145" y="1046.3232">可中断</text><path d="M1092,1004.8828 L1102,1004.8828 C1117,1004.8828 1117,1041.4766 1132,1041.4766 L1142,1041.4766 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M930,586.6094 L940,586.6094 C955,586.6094 955,1004.8828 970,1004.8828 L980,1004.8828 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M846,795.4297 L856,795.4297 C871,795.4297 871,586.6094 886,586.6094 L896,586.6094 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1n6debg86egv)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="90" x="896" y="1297.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="906" y="1320.5889">并发工具类</text><rect fill="#FEFECE" filter="url(#f1n6debg86egv)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="160" x="1036" y="1162.6641"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="140" x="1046" y="1185.6592">concurrenthashmap</text><rect fill="#FEFECE" filter="url(#f1n6debg86egv)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="146" x="1246" y="1097.2188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="126" x="1256" y="1120.2139">怎么保证线程安全的</text><rect fill="#FEFECE" filter="url(#f1n6debg86egv)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="172" x="1442" y="1060.625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="152" x="1452" y="1083.6201">HashMap 为什么不安全</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="82" x="1667" y="1074.4717">多线程的put</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="1749" y="1074.4717">可能导致</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="70" x="1805" y="1074.4717">元素的丢失</text><path d="M1614,1078.7734 L1624,1078.7734 C1639,1078.7734 1639,1069.625 1654,1069.625 L1664,1069.625 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60" x="1667" y="1092.7686">put和get</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="28" x="1727" y="1092.7686">并发</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="1755" y="1092.7686">时，可能导致</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="68" x="1839" y="1092.7686">get为null</text><path d="M1614,1078.7734 L1624,1078.7734 C1639,1078.7734 1639,1087.9219 1654,1087.9219 L1664,1087.9219 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1392,1115.3672 L1402,1115.3672 C1417,1115.3672 1417,1078.7734 1432,1078.7734 L1442,1078.7734 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1n6debg86egv)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="161" x="1442" y="1125.3672"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="141" x="1452" y="1148.3623">synchronized + CAS</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="1656" y="1120.917">读安全：使用</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="56" x="1744" y="1120.917">volatile</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="129" x="1804" y="1120.917">保证当 Node 中的值</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="154" x="1933" y="1120.917">变化时对于其他线程可见</text><path d="M1603,1143.5156 L1613,1143.5156 C1628,1143.5156 1628,1116.0703 1643,1116.0703 L1653,1116.0703 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="1656" y="1139.2139">写安全：使用</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="128" x="1744" y="1139.2139">table 数组的头结点</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="143" x="1872" y="1139.2139">作为 synchronized 的</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="14" x="2015" y="1139.2139">锁</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="2029" y="1139.2139">来保证</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="84" x="2071" y="1139.2139">写操作的安全</text><path d="M1603,1143.5156 L1613,1143.5156 C1628,1143.5156 1628,1134.3672 1643,1134.3672 L1653,1134.3672 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="214" x="1656" y="1157.5107">写安全：当头结点为 null 时，使用</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="32" x="1874" y="1157.5107">CAS</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="1910" y="1157.5107">操作来</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="140" x="1952" y="1157.5107">保证数据能正确的写入</text><path d="M1603,1143.5156 L1613,1143.5156 C1628,1143.5156 1628,1152.6641 1643,1152.6641 L1653,1152.6641 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="429" x="1656" y="1175.8076">扩容安全：Synchronized 头节点，标记 moved，再插入的自旋等待</text><path d="M1603,1143.5156 L1613,1143.5156 C1628,1143.5156 1628,1170.9609 1643,1170.9609 L1653,1170.9609 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1392,1115.3672 L1402,1115.3672 C1417,1115.3672 1417,1143.5156 1432,1143.5156 L1442,1143.5156 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1196,1180.8125 L1206,1180.8125 C1221,1180.8125 1221,1115.3672 1236,1115.3672 L1246,1115.3672 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1n6debg86egv)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="173" x="1246" y="1190.1094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="153" x="1256" y="1213.1045">为什么用 synchronized</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="362" x="1472" y="1194.8076">头结点如果使用 ReentrantLock，需继承 AQS，增加内存</text><path d="M1419,1208.2578 L1429,1208.2578 C1444,1208.2578 1444,1189.9609 1459,1189.9609 L1469,1189.9609 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="1472" y="1213.1045">降低了锁粒度</text><path d="M1419,1208.2578 L1429,1208.2578 C1444,1208.2578 1444,1208.2578 1459,1208.2578 L1469,1208.2578 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="167" x="1472" y="1231.4014">JVM 会优化 synchronized</text><path d="M1419,1208.2578 L1429,1208.2578 C1444,1208.2578 1444,1226.5547 1459,1226.5547 L1469,1226.5547 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1196,1180.8125 L1206,1180.8125 C1221,1180.8125 1221,1208.2578 1236,1208.2578 L1246,1208.2578 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="1249" y="1250.4014">分段锁有什么问题</text><path d="M1196,1180.8125 L1206,1180.8125 C1221,1180.8125 1221,1245.5547 1236,1245.5547 L1246,1245.5547 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1n6debg86egv)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="302" x="1246" y="1264.7031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="282" x="1256" y="1287.6982">hash算法 (h ^ (h &gt;&gt;&gt; 16)) &amp; HASH_BITS</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="1601" y="1278.5498">高位参与</text><path d="M1548,1282.8516 L1558,1282.8516 C1573,1282.8516 1573,1273.7031 1588,1273.7031 L1598,1273.7031 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="189" x="1601" y="1296.8467">HASH_BITS 0x7fffffff，变正数</text><path d="M1548,1282.8516 L1558,1282.8516 C1573,1282.8516 1573,1292 1588,1292 L1598,1292 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1196,1180.8125 L1206,1180.8125 C1221,1180.8125 1221,1282.8516 1236,1282.8516 L1246,1282.8516 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M986,1315.7422 L996,1315.7422 C1011,1315.7422 1011,1180.8125 1026,1180.8125 L1036,1180.8125 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1n6debg86egv)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="96" x="1036" y="1382.0391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76" x="1046" y="1405.0342">threadlocal</text><rect fill="#FEFECE" filter="url(#f1n6debg86egv)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="132" x="1182" y="1321"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="1192" y="1343.9951">什么场景下使用的</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="33" x="1367" y="1334.8467">MDC</text><path d="M1314,1339.1484 L1324,1339.1484 C1339,1339.1484 1339,1330 1354,1330 L1364,1330 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47" x="1367" y="1353.1436">traceid</text><path d="M1314,1339.1484 L1324,1339.1484 C1339,1339.1484 1339,1348.2969 1354,1348.2969 L1364,1348.2969 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1132,1400.1875 L1142,1400.1875 C1157,1400.1875 1157,1339.1484 1172,1339.1484 L1182,1339.1484 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="1185" y="1381.292">原理</text><path d="M1132,1400.1875 L1142,1400.1875 C1157,1400.1875 1157,1376.4453 1172,1376.4453 L1182,1376.4453 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="1189" y="1399.5889"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="197" x="1185" y="1415.8857">hash冲突怎么办: 开放地址法，</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="266" x="1185" y="1432.1826">不为 null，且已经过期，则启动谈测试清理</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="1189" y="1448.4795"/><path d="M1132,1400.1875 L1142,1400.1875 C1157,1400.1875 1157,1419.1875 1172,1419.1875 L1182,1419.1875 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="1185" y="1466.7764">扩容实现</text><path d="M1132,1400.1875 L1142,1400.1875 C1157,1400.1875 1157,1461.9297 1172,1461.9297 L1182,1461.9297 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="182" x="1185" y="1485.0732">内存泄漏产生原因，怎么解决</text><path d="M1132,1400.1875 L1142,1400.1875 C1157,1400.1875 1157,1480.2266 1172,1480.2266 L1182,1480.2266 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M986,1315.7422 L996,1315.7422 C1011,1315.7422 1011,1400.1875 1026,1400.1875 L1036,1400.1875 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1n6debg86egv)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="62" x="1036" y="1516.9688"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="1046" y="1539.9639">线程池</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="1151" y="1503.3701">原理</text><path d="M1098,1535.1172 L1108,1535.1172 C1123,1535.1172 1123,1498.5234 1138,1498.5234 L1148,1498.5234 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="1151" y="1521.667">核心参数</text><path d="M1098,1535.1172 L1108,1535.1172 C1123,1535.1172 1123,1516.8203 1138,1516.8203 L1148,1516.8203 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="1151" y="1539.9639">线程数设置</text><path d="M1098,1535.1172 L1108,1535.1172 C1123,1535.1172 1123,1535.1172 1138,1535.1172 L1148,1535.1172 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="165" x="1151" y="1558.2607">参数动态调整后变化过程 *</text><path d="M1098,1535.1172 L1108,1535.1172 C1123,1535.1172 1123,1553.4141 1138,1553.4141 L1148,1553.4141 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="123" x="1151" y="1576.5576">线程抛异常怎么办 *</text><path d="M1098,1535.1172 L1108,1535.1172 C1123,1535.1172 1123,1571.7109 1138,1571.7109 L1148,1571.7109 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M986,1315.7422 L996,1315.7422 C1011,1315.7422 1011,1535.1172 1026,1535.1172 L1036,1535.1172 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M846,795.4297 L856,795.4297 C871,795.4297 871,1315.7422 886,1315.7422 L896,1315.7422 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M700,795.4297 L710,795.4297 C725,795.4297 725,795.4297 740,795.4297 L750,795.4297 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1n6debg86egv)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="48" x="556" y="587.6289"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="566" y="610.624">线程</text><rect fill="#FEFECE" filter="url(#f1n6debg86egv)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="76" x="430" y="587.6289"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="440" y="610.624">线程状态</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="32" x="345" y="499.4365">NEW</text><path d="M430,605.7773 L420,605.7773 C405,605.7773 405,494.5898 390,494.5898 L380,494.5898 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75" x="302" y="517.7334">RUNNABLE</text><path d="M430,605.7773 L420,605.7773 C405,605.7773 405,512.8867 390,512.8867 L380,512.8867 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1n6debg86egv)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="87" x="293" y="532.0352"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="67" x="303" y="555.0303">BLOCKED</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="188" x="52" y="545.8818">等待 montor lock 进入同步区</text><path d="M293,550.1836 L283,550.1836 C268,550.1836 268,541.0352 253,541.0352 L243,541.0352 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="230" x="10" y="564.1787">Object.wait() 后阻塞重新进入同步区</text><path d="M293,550.1836 L283,550.1836 C268,550.1836 268,559.332 253,559.332 L243,559.332 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M430,605.7773 L420,605.7773 C405,605.7773 405,550.1836 390,550.1836 L380,550.1836 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1n6debg86egv)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="78" x="302" y="588.332"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="58" x="312" y="611.3271">WAITING</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="118" x="131" y="593.0303">无限 Object.wait()</text><path d="M302,606.4805 L292,606.4805 C277,606.4805 277,588.1836 262,588.1836 L252,588.1836 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="119" x="130" y="611.3271">无限 Thread.join()</text><path d="M302,606.4805 L292,606.4805 C277,606.4805 277,606.4805 262,606.4805 L252,606.4805 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="121" x="128" y="629.624">LockSupport.park</text><path d="M302,606.4805 L292,606.4805 C277,606.4805 277,624.7773 262,624.7773 L252,624.7773 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M430,605.7773 L420,605.7773 C405,605.7773 405,606.4805 390,606.4805 L380,606.4805 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1n6debg86egv)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="129" x="251" y="661.5195"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109" x="261" y="684.5146">TIMED_WAITING</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91" x="107" y="647.9209">Thread.sleep</text><path d="M251,679.668 L241,679.668 C226,679.668 226,643.0742 211,643.0742 L201,643.0742 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="118" x="80" y="666.2178">有限 Object.wait()</text><path d="M251,679.668 L241,679.668 C226,679.668 226,661.3711 211,661.3711 L201,661.3711 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="119" x="79" y="684.5146">有限 Thread.join()</text><path d="M251,679.668 L241,679.668 C226,679.668 226,679.668 211,679.668 L201,679.668 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="165" x="33" y="702.8115">LockSupport.parkNanos</text><path d="M251,679.668 L241,679.668 C226,679.668 226,697.9648 211,697.9648 L201,697.9648 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="151" x="47" y="721.1084">LockSupport.parkUntil</text><path d="M251,679.668 L241,679.668 C226,679.668 226,716.2617 211,716.2617 L201,716.2617 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M430,605.7773 L420,605.7773 C405,605.7773 405,679.668 390,679.668 L380,679.668 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91" x="286" y="721.8115">TERMINATED</text><path d="M430,605.7773 L420,605.7773 C405,605.7773 405,716.9648 390,716.9648 L380,716.9648 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M556,605.7773 L546,605.7773 C531,605.7773 531,605.7773 516,605.7773 L506,605.7773 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="434" y="647.9209">interrupt()</text><path d="M556,605.7773 L546,605.7773 C531,605.7773 531,643.0742 516,643.0742 L506,643.0742 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M654,795.4297 L644,795.4297 C629,795.4297 629,605.7773 614,605.7773 L604,605.7773 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1n6debg86egv)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="48" x="556" y="776.9297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="566" y="799.9248">集合</text><rect fill="#FEFECE" filter="url(#f1n6debg86egv)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="84" x="422" y="753.707"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="432" y="776.7021">hashmap</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="102" x="267" y="740.1084">原理, put &amp; get</text><path d="M422,771.8555 L412,771.8555 C397,771.8555 397,735.2617 382,735.2617 L372,735.2617 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="72" x="297" y="758.4053">8转红黑树?</text><path d="M422,771.8555 L412,771.8555 C397,771.8555 397,753.5586 382,753.5586 L372,753.5586 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="140" x="229" y="776.7021">什么时候扩容? 0.75？</text><path d="M422,771.8555 L412,771.8555 C397,771.8555 397,771.8555 382,771.8555 L372,771.8555 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="168" x="201" y="794.999">扩容步骤，为什么分高低位</text><path d="M422,771.8555 L412,771.8555 C397,771.8555 397,790.1523 382,790.1523 L372,790.1523 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="238" x="127" y="813.2959">头插法有什么问题，为什么线程不安全</text><path d="M422,771.8555 L412,771.8555 C397,771.8555 397,808.4492 382,808.4492 L372,808.4492 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M556,795.0781 L546,795.0781 C531,795.0781 531,771.8555 516,771.8555 L506,771.8555 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1n6debg86egv)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="72" x="434" y="817.7461"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="52" x="444" y="840.7412">arraylist</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="103" x="278" y="831.5928">数组加transient</text><path d="M434,835.8945 L424,835.8945 C409,835.8945 409,826.7461 394,826.7461 L384,826.7461 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="325" y="849.8896">扩容原理</text><path d="M434,835.8945 L424,835.8945 C409,835.8945 409,845.043 394,845.043 L384,845.043 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M556,795.0781 L546,795.0781 C531,795.0781 531,835.8945 516,835.8945 L506,835.8945 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M654,795.4297 L644,795.4297 C629,795.4297 629,795.0781 614,795.0781 L604,795.0781 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1n6debg86egv)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="76" x="528" y="874.043"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="538" y="897.0381">动态代理</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="273" x="202" y="887.8896">spring aop的理解，解决什么问题,实现原理</text><path d="M528,892.1914 L518,892.1914 C503,892.1914 503,883.043 488,883.043 L478,883.043 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="196" x="279" y="906.1865">jdk动态代理,cglib区别，优缺点</text><path d="M528,892.1914 L518,892.1914 C503,892.1914 503,901.3398 488,901.3398 L478,901.3398 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M654,795.4297 L644,795.4297 C629,795.4297 629,892.1914 614,892.1914 L604,892.1914 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1n6debg86egv)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="48" x="556" y="930.3398"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="566" y="953.335">反射</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="475" y="953.335">原理</text><path d="M556,948.4883 L546,948.4883 C531,948.4883 531,948.4883 516,948.4883 L506,948.4883 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M654,795.4297 L644,795.4297 C629,795.4297 629,948.4883 614,948.4883 L604,948.4883 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1n6debg86egv)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="44" x="560" y="986.6367"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="24" x="570" y="1009.6318">NIO</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="451" y="991.335">实现原理</text><path d="M560,1004.7852 L550,1004.7852 C535,1004.7852 535,986.4883 520,986.4883 L510,986.4883 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="465" y="1009.6318">优缺点</text><path d="M560,1004.7852 L550,1004.7852 C535,1004.7852 535,1004.7852 520,1004.7852 L510,1004.7852 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="217" x="290" y="1027.9287">netty的设计模型，架构，使用场景</text><path d="M560,1004.7852 L550,1004.7852 C535,1004.7852 535,1023.082 520,1023.082 L510,1023.082 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M654,795.4297 L644,795.4297 C629,795.4297 629,1004.7852 614,1004.7852 L604,1004.7852 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1n6debg86egv)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="76" x="528" y="1050.6758"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="538" y="1073.6709">引用类型</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="42" x="373" y="1046.2256">强引用</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60" x="415" y="1046.2256">： 强引用</text><path d="M528,1068.8242 L518,1068.8242 C503,1068.8242 503,1041.3789 488,1041.3789 L478,1041.3789 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="42" x="106" y="1064.5225">软引用</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="327" x="148" y="1064.5225">：SoftReference 修饰，在内存要溢出的时候被回收</text><path d="M528,1068.8242 L518,1068.8242 C503,1068.8242 503,1059.6758 488,1059.6758 L478,1059.6758 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="42" x="158" y="1082.8193">弱引用</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="275" x="200" y="1082.8193">：WeakReference，发生 GC，就会被回收</text><path d="M528,1068.8242 L518,1068.8242 C503,1068.8242 503,1077.9727 488,1077.9727 L478,1077.9727 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="42" x="173" y="1101.1162">虚引用</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="260" x="215" y="1101.1162">：PhantomReference，熄火时接到通知</text><path d="M528,1068.8242 L518,1068.8242 C503,1068.8242 503,1096.2695 488,1096.2695 L478,1096.2695 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M654,795.4297 L644,795.4297 C629,795.4297 629,1068.8242 614,1068.8242 L604,1068.8242 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[96de44f5bc71c5aeee37026b95984445]
@startmindmap
* Java

** 并发 & 同步

*** [[https://tech.meituan.com/2018/11/15/java-lock.html 锁事-美团]] synchronized 
****_ [[https://xiaomi-info.github.io/2020/03/24/synchronized/ 原理-小米]]，可重入性，可见性
****_ 锁升级

*** volatile
****_ 可见性
****_ 内存屏障

*** 锁
**** 锁升级
***** 偏向锁
******_ 一直被一个线程所访问
******_ 在 **Mark Word** 里存储锁偏向的线程 **ID**
******_: 
**撤销**：
只有遇到其他线程尝试竞争偏向锁时，
持有偏向锁的线程才会释放锁，
**不会主动释**放偏向锁。
**等待全局安全点**，暂停拥有偏向锁的线程，
判断锁对象是否处于被锁定状态。
恢复无锁（标志位为 01）或轻量级锁（标志位为 00）的状态
;
***** 轻量级锁
******_ 线程会通过自旋的形式尝试获取锁，不会阻塞，从而提高性能。
******_: 
无锁状态: 
在**当前线程的栈帧**中建立一个名为**锁记录**（Lock Record）的空间，
用于存储锁对象目前的 **Mark Word** 的拷贝，
然后拷贝对象头中的 **Mark Word** 复制到锁记录中。
CAS 操作尝试将对象的 **Mark Word** **更新**为指向 **Lock Record** 的指针，
并将 **Lock Record** 里的 **owner** 指针指向对象的 **Mark Word**。
更新**成功**： 线程就拥有了该对象的锁，锁标志位设置为“00”。
更新**失败**： 对象的 Mark Word 是否**指向当前线程的栈帧**？
只有当前一个等待线程，自旋；
自旋超过次数，或来第三个，膨胀。
;
*****_ 重量级锁：管程

****_: 
**乐观**: 只是在更新数据的时候去判断之前有没有别的线程更新了这个数据，
没有被更新，当前线程将自己修改的数据成功写入。
已经被其他线程更新，则根据不同的实现方式执行不同的操作（报错或重试）
;
****_: 
**悲观**: 使用数据的时候一定有别的线程来修改数据,
在获取数据的时候会先加锁,
确保数据不会被别的线程修改。
;
**** CAS
*****_ 乐观锁中的重试
*****_ **ABA问题**: AtomicStampedReference
*****_ **只能保证一个共享变量的原子操作**: AtomicReference
*****_ **循环时间长开销大**: 只能保证一个共享变量的原子操作
**** 死锁
***** 产生条件
******_  **互斥条件**：一个资源每次只能被一个进程使用。
******_ **占有且等待**：一个进程因请求资源而阻塞时，对已获得的资源保持不放。
******_ **不可强行占有**: 进程已获得的资源，在末使用完之前，不能强行剥夺。
******_ **循环等待条件**: 若干进程之间形成一种头尾相接的循环等待资源关系。
***** 排查
******_ jstat $PID
******_ jcmd $PID Thread.print
******_:
ThreadMXBean bean = ManagementFactory.getThreadMXBean()
long[] threadIds = bean.findDeadlockedThreads()
;
**** reentrantlock
*****_ 实现原理，加锁和释放锁的一个过程
*****_ aqs
*****_ 公平和非公平
*****_ 可重入
*****_ 可中断


*** 并发工具类
**** concurrenthashmap
***** 怎么保证线程安全的
****** HashMap 为什么不安全
*******_ **多线程的put**可能导致**元素的丢失**
*******_ put和get**并发**时，可能导致**get为null**
****** synchronized + CAS
*******_ 读安全：使用 **volatile** 保证当 Node 中的值**变化时对于其他线程可见**
*******_ 写安全：使用 **table 数组的头结点**作为 synchronized 的**锁**来保证**写操作的安全**
*******_ 写安全：当头结点为 null 时，使用 **CAS** 操作来**保证数据能正确的写入**
*******_ 扩容安全：Synchronized 头节点，标记 moved，再插入的自旋等待
***** 为什么用 synchronized
******_ 头结点如果使用 ReentrantLock，需继承 AQS，增加内存
******_ 降低了锁粒度
******_ JVM 会优化 synchronized
*****_ 分段锁有什么问题
***** hash算法 (h ^ (h >>> 16)) & HASH_BITS
******_ 高位参与
******_ HASH_BITS 0x7fffffff，变正数

**** threadlocal
***** 什么场景下使用的
******_ MDC
******_ traceid
*****_ 原理
*****_: 
hash冲突怎么办: 开放地址法，
不为 null，且已经过期，则启动谈测试清理
;
*****_ 扩容实现
*****_ 内存泄漏产生原因，怎么解决
**** 线程池
*****_ 原理
*****_ 核心参数
*****_ 线程数设置
*****_ 参数动态调整后变化过程 *
*****_ 线程抛异常怎么办 *


left side

** 线程
*** 线程状态
****_ NEW
****_ RUNNABLE
**** BLOCKED
*****_ 等待 montor lock 进入同步区
*****_ Object.wait() 后阻塞重新进入同步区
**** WAITING
*****_ 无限 Object.wait()
*****_ 无限 Thread.join()
*****_ LockSupport.park
**** TIMED_WAITING
*****_ Thread.sleep
*****_ 有限 Object.wait()
*****_ 有限 Thread.join()
*****_ LockSupport.parkNanos
*****_ LockSupport.parkUntil
****_ TERMINATED

***_ interrupt()

** 集合

*** hashmap
****_ 原理, put & get
****_ 8转红黑树?
****_ 什么时候扩容? 0.75？
****_ 扩容步骤，为什么分高低位
****_ 头插法有什么问题，为什么线程不安全 

*** arraylist
****_ 数组加transient
****_ 扩容原理


** 动态代理
***_ spring aop的理解，解决什么问题,实现原理
***_ jdk动态代理,cglib区别，优缺点

** 反射
***_ 原理

** NIO
***_ 实现原理
***_ 优缺点
***_ netty的设计模型，架构，使用场景

** 引用类型
***_ **强引用**： 强引用
***_ **软引用**：SoftReference 修饰，在内存要溢出的时候被回收
***_ **弱引用**：WeakReference，发生 GC，就会被回收
***_ **虚引用**：PhantomReference，熄火时接到通知

@endmindmap

PlantUML version 1.2021.6(Fri May 14 07:09:51 UTC 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>