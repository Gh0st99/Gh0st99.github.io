<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1873px" preserveAspectRatio="none" style="width:1335px;height:1873px;" version="1.1" viewBox="0 0 1335 1873" width="1335px" zoomAndPan="magnify"><defs><filter height="300%" id="ffl6dfc65c1vi" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FEFECE" filter="url(#ffl6dfc65c1vi)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="66" x="10" y="917.7578"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="20" y="940.7529">MySQL</text><rect fill="#FEFECE" filter="url(#ffl6dfc65c1vi)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="193" x="126" y="65.7422"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="25" x="136" y="88.7373">Log</text><a href="https://zhuanlan.zhihu.com/p/58011817" target="_top" title="https://zhuanlan.zhihu.com/p/58011817" xlink:actuate="onRequest" xlink:href="https://zhuanlan.zhihu.com/p/58011817" xlink:show="new" xlink:title="https://zhuanlan.zhihu.com/p/58011817" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="144" x="165" y="88.7373">MySQL日志分类及简介</text></a><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="372" y="23.9951">错误日志</text><path d="M319,83.8906 L329,83.8906 C344,83.8906 344,19.1484 359,19.1484 L369,19.1484 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="372" y="42.292">查询日志</text><path d="M319,83.8906 L329,83.8906 C344,83.8906 344,37.4453 359,37.4453 L369,37.4453 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="372" y="60.5889">慢查询日志 *</text><path d="M319,83.8906 L329,83.8906 C344,83.8906 344,55.7422 359,55.7422 L369,55.7422 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#ffl6dfc65c1vi)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="76" x="369" y="74.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="379" y="97.8857">事务日志</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="127" x="498" y="88.7373">重做日志 (redo log)</text><path d="M445,93.0391 L455,93.0391 C470,93.0391 470,83.8906 485,83.8906 L495,83.8906 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="131" x="498" y="107.0342">回滚日志 (undo log)</text><path d="M445,93.0391 L455,93.0391 C470,93.0391 470,102.1875 485,102.1875 L495,102.1875 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M319,83.8906 L329,83.8906 C344,83.8906 344,93.0391 359,93.0391 L369,93.0391 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="372" y="135.1826">二进制日志</text><path d="M319,83.8906 L329,83.8906 C344,83.8906 344,130.3359 359,130.3359 L369,130.3359 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="372" y="153.4795">中继日志</text><path d="M319,83.8906 L329,83.8906 C344,83.8906 344,148.6328 359,148.6328 L369,148.6328 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M76,935.9063 L86,935.9063 C101,935.9063 101,83.8906 116,83.8906 L126,83.8906 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#ffl6dfc65c1vi)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="71" x="126" y="342.3047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="136" y="365.2998">InnoDB</text><rect fill="#FEFECE" filter="url(#ffl6dfc65c1vi)" height="101.4844" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="155" x="247" y="309.7109"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="261" y="332.7061"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="257" y="349.0029">结构</text><a href="https://zhuanlan.zhihu.com/p/235458760" target="_top" title="https://zhuanlan.zhihu.com/p/235458760" xlink:actuate="onRequest" xlink:href="https://zhuanlan.zhihu.com/p/235458760" xlink:show="new" xlink:title="https://zhuanlan.zhihu.com/p/235458760" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="107" x="257" y="365.2998">深入剖析InnoDB</text></a><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="368" y="365.2998"/><a href="https://draveness.me/mysql-innodb/" target="_top" title="https://draveness.me/mysql-innodb/" xlink:actuate="onRequest" xlink:href="https://draveness.me/mysql-innodb/" xlink:show="new" xlink:title="https://draveness.me/mysql-innodb/" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="135" x="257" y="381.5967">『浅入浅出』InnoDB</text></a><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="261" y="397.8936"/><rect fill="#FEFECE" filter="url(#ffl6dfc65c1vi)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="62" x="452" y="249.7656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="462" y="272.7607">内存中</text><rect fill="#FEFECE" filter="url(#ffl6dfc65c1vi)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="147" x="564" y="176.2266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="127" x="574" y="199.2217">缓冲池(Buffer Pool)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="154" x="764" y="171.7764">缓存访问的索引和表数据</text><path d="M711,194.375 L721,194.375 C736,194.375 736,166.9297 751,166.9297 L761,166.9297 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="764" y="190.0732">常用数据内存访问</text><path d="M711,194.375 L721,194.375 C736,194.375 736,185.2266 751,185.2266 L761,185.2266 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="103" x="764" y="208.3701">80%+ 内存占用</text><path d="M711,194.375 L721,194.375 C736,194.375 736,203.5234 751,203.5234 L761,203.5234 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="269" x="764" y="226.667">划分为包含多行的链表连接的页，LRU 淘汰</text><path d="M711,194.375 L721,194.375 C736,194.375 736,221.8203 751,221.8203 L761,221.8203 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M514,267.9141 L524,267.9141 C539,267.9141 539,194.375 554,194.375 L564,194.375 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#ffl6dfc65c1vi)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="185" x="564" y="249.4141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="165" x="574" y="272.4092">写缓冲区(Change Buffer)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="398" x="802" y="244.9639">内存：占用 buffer pool 的内存；硬盘渣弄 system tablespace</text><path d="M749,267.5625 L759,267.5625 C774,267.5625 774,240.1172 789,240.1172 L799,240.1172 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="166" x="802" y="263.2607">缓存不在 buffer pool 中的</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="56" x="968" y="263.2607">二级索引</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="1024" y="263.2607">的修改</text><path d="M749,267.5625 L759,267.5625 C774,267.5625 774,258.4141 789,258.4141 L799,258.4141 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="338" x="802" y="281.5576">当其他读将页加载到 buffer pool 中合并，减少随机 IO</text><path d="M749,267.5625 L759,267.5625 C774,267.5625 774,276.7109 789,276.7109 L799,276.7109 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="364" x="802" y="299.8545">当系统空闲或者 slow shutdown 周期性将更新的索引写盘</text><path d="M749,267.5625 L759,267.5625 C774,267.5625 774,295.0078 789,295.0078 L799,295.0078 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M514,267.9141 L524,267.9141 C539,267.9141 539,267.5625 554,267.5625 L564,267.5625 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#ffl6dfc65c1vi)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="166" x="564" y="313.4531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="146" x="574" y="336.4482">日志缓冲区(log Buffer)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="197" x="783" y="318.1514">持有写入硬盘的 log 文件的数据</text><path d="M730,331.6016 L740,331.6016 C755,331.6016 755,313.3047 770,313.3047 L780,313.3047 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="783" y="336.4482">周期性刷盘</text><path d="M730,331.6016 L740,331.6016 C755,331.6016 755,331.6016 770,331.6016 L780,331.6016 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="429" x="783" y="354.7451">更大可以使运行大事务不需要在提交事务前写入 redo log 数据到硬盘</text><path d="M730,331.6016 L740,331.6016 C755,331.6016 755,349.8984 770,349.8984 L780,349.8984 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M514,267.9141 L524,267.9141 C539,267.9141 539,331.6016 554,331.6016 L564,331.6016 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="113" x="567" y="373.7451">自适应 Hash 索引</text><path d="M514,267.9141 L524,267.9141 C539,267.9141 539,368.8984 554,368.8984 L564,368.8984 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M402,360.4531 L412,360.4531 C427,360.4531 427,267.9141 442,267.9141 L452,267.9141 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#ffl6dfc65c1vi)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="62" x="452" y="452.4375"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="462" y="475.4326">硬盘中</text><rect fill="#FEFECE" filter="url(#ffl6dfc65c1vi)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="154" x="564" y="396.4922"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="134" x="574" y="419.4873">Double Write Buffer</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91" x="771" y="392.042">事物原子性 -&gt;</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="101" x="866" y="392.042">磁盘 I/O 原子性</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="104" x="967" y="392.042">。Page 16KB。</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="100" x="1071" y="392.042">Page 的原子性</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="14" x="1171" y="392.042">？</text><path d="M718,414.6406 L728,414.6406 C743,414.6406 743,387.1953 758,387.1953 L768,387.1953 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="204" x="771" y="410.3389">buffer pool 写入硬盘前写到这里</text><path d="M718,414.6406 L728,414.6406 C743,414.6406 743,405.4922 758,405.4922 L768,405.4922 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="332" x="771" y="428.6357">在故障恢复中可以在这里找到一份 page 的好的 copy</text><path d="M718,414.6406 L728,414.6406 C743,414.6406 743,423.7891 758,423.7891 L768,423.7891 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="552" x="771" y="446.9326">虽然数据写入两次(doublewrite buffer + page),但是写到 dw 是大块写入，一次 fsync()</text><path d="M718,414.6406 L728,414.6406 C743,414.6406 743,442.0859 758,442.0859 L768,442.0859 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M514,470.5859 L524,470.5859 C539,470.5859 539,414.6406 554,414.6406 L564,414.6406 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#ffl6dfc65c1vi)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="86" x="564" y="460.5313"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="574" y="483.5264">Redo Log</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="224" x="703" y="465.2295">故障恢复中修正未完成的事务的数据</text><path d="M650,478.6797 L660,478.6797 C675,478.6797 675,460.3828 690,460.3828 L700,460.3828 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="368" x="703" y="483.5264">SQL 语句或低级 API 调用产生的更改表数据的请求进行编码</text><path d="M650,478.6797 L660,478.6797 C675,478.6797 675,478.6797 690,478.6797 L700,478.6797 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="156" x="703" y="501.8232">ib_logfile0 &amp; ib_logfile1</text><path d="M650,478.6797 L660,478.6797 C675,478.6797 675,496.9766 690,496.9766 L700,496.9766 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M514,470.5859 L524,470.5859 C539,470.5859 539,478.6797 554,478.6797 L564,478.6797 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#ffl6dfc65c1vi)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="86" x="564" y="516.8281"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="574" y="539.8232">Undo Log</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="280" x="703" y="530.6748">与单个读写事务相关联的撤消日志记录的集合</text><path d="M650,534.9766 L660,534.9766 C675,534.9766 675,525.8281 690,525.8281 L700,525.8281 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="350" x="703" y="548.9717">包含有关如何撤消事务对聚集索引记录的最新更改的信息</text><path d="M650,534.9766 L660,534.9766 C675,534.9766 675,544.125 690,544.125 L700,544.125 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M514,470.5859 L524,470.5859 C539,470.5859 539,534.9766 554,534.9766 L564,534.9766 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M402,360.4531 L412,360.4531 C427,360.4531 427,470.5859 442,470.5859 L452,470.5859 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M197,360.4531 L207,360.4531 C222,360.4531 222,360.4531 237,360.4531 L247,360.4531 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M76,935.9063 L86,935.9063 C101,935.9063 101,360.4531 116,360.4531 L126,360.4531 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#ffl6dfc65c1vi)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="53" x="126" y="666.7188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="33" x="136" y="689.7139">ACID</text><rect fill="#FEFECE" filter="url(#ffl6dfc65c1vi)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="178" x="229" y="573.125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="158" x="239" y="596.1201">Atomicity 中止（abort）</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="392" x="460" y="586.9717">能够在错误时中止事务，丢弃该事务进行的所有写入变更的能力</text><path d="M407,591.2734 L417,591.2734 C432,591.2734 432,582.125 447,582.125 L457,582.125 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="460" y="605.2686">事物</text><path d="M407,591.2734 L417,591.2734 C432,591.2734 432,600.4219 447,600.4219 L457,600.4219 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M179,684.8672 L189,684.8672 C204,684.8672 204,591.2734 219,591.2734 L229,591.2734 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#ffl6dfc65c1vi)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="244" x="229" y="629.4219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="224" x="239" y="652.417">Consistency 不变量（invariants）</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="125" x="526" y="652.417">doublewrite buffer</text><path d="M473,647.5703 L483,647.5703 C498,647.5703 498,647.5703 513,647.5703 L523,647.5703 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M179,684.8672 L189,684.8672 C204,684.8672 204,647.5703 219,647.5703 L229,647.5703 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#ffl6dfc65c1vi)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="77" x="229" y="694.8672"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="239" y="717.8623">Isolation</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="14" x="359" y="689.7139">锁</text><path d="M306,713.0156 L316,713.0156 C331,713.0156 331,684.8672 346,684.8672 L356,684.8672 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#ffl6dfc65c1vi)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="104" x="356" y="704.0156"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="366" y="727.0107">事物隔离级别</text><path d="M306,713.0156 L316,713.0156 C331,713.0156 331,722.1641 346,722.1641 L356,722.1641 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M179,684.8672 L189,684.8672 C204,684.8672 204,713.0156 219,713.0156 L229,713.0156 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#ffl6dfc65c1vi)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="83" x="229" y="760.3125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63" x="239" y="783.3076">Durability</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="125" x="365" y="774.1592">doublewrite buffer</text><path d="M312,778.4609 L322,778.4609 C337,778.4609 337,769.3125 352,769.3125 L362,769.3125 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="365" y="792.4561">运维</text><path d="M312,778.4609 L322,778.4609 C337,778.4609 337,787.6094 352,787.6094 L362,787.6094 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M179,684.8672 L189,684.8672 C204,684.8672 204,778.4609 219,778.4609 L229,778.4609 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M76,935.9063 L86,935.9063 C101,935.9063 101,684.8672 116,684.8672 L126,684.8672 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#ffl6dfc65c1vi)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="76" x="126" y="863.0547"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="136" y="886.0498">隔离级别</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="149" x="255" y="820.6045">READ UNCOMMITTED</text><path d="M202,881.2031 L212,881.2031 C227,881.2031 227,815.7578 242,815.7578 L252,815.7578 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#ffl6dfc65c1vi)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="149" x="252" y="834.9063"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="129" x="262" y="857.9014">READ COMMITTED</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="405" x="454" y="848.7529">在同个事务中的每个一致性读设置及读其自己的新鲜的 snapshot</text><path d="M401,853.0547 L411,853.0547 C426,853.0547 426,843.9063 441,843.9063 L451,843.9063 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="428" x="454" y="867.0498">lock r &amp; u &amp; d: 只锁索引记录而没有前面的 gap，可以任意插入记录</text><path d="M401,853.0547 L411,853.0547 C426,853.0547 426,862.2031 441,862.2031 L451,862.2031 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M202,881.2031 L212,881.2031 C227,881.2031 227,853.0547 242,853.0547 L252,853.0547 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#ffl6dfc65c1vi)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="153" x="252" y="891.2031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="133" x="262" y="914.1982">REPEATABLE READ</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="458" y="886.0498">同个事物的</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="56" x="528" y="886.0498">一致性读</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="195" x="584" y="886.0498">读取第一个读建立的 snapshot</text><path d="M405,909.3516 L415,909.3516 C430,909.3516 430,881.2031 445,881.2031 L455,881.2031 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#ffl6dfc65c1vi)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="237" x="455" y="900.3516"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="217" x="465" y="923.3467">locking read &amp; update &amp; delete</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="272" x="745" y="914.1982">查询使用唯一索引只锁找到的 index record</text><path d="M692,918.5 L702,918.5 C717,918.5 717,909.3516 732,909.3516 L742,909.3516 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="182" x="745" y="932.4951">其他情况锁扫描到的索引范围</text><path d="M692,918.5 L702,918.5 C717,918.5 717,927.6484 732,927.6484 L742,927.6484 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M405,909.3516 L415,909.3516 C430,909.3516 430,918.5 445,918.5 L455,918.5 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M202,881.2031 L212,881.2031 C227,881.2031 227,909.3516 242,909.3516 L252,909.3516 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="255" y="951.4951">SERIALIZABLE</text><path d="M202,881.2031 L212,881.2031 C227,881.2031 227,946.6484 242,946.6484 L252,946.6484 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M76,935.9063 L86,935.9063 C101,935.9063 101,881.2031 116,881.2031 L126,881.2031 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#ffl6dfc65c1vi)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="61" x="126" y="965.7969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="41" x="136" y="988.792">MVCC</text><rect fill="#FEFECE" filter="url(#ffl6dfc65c1vi)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="146" x="237" y="965.7969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="126" x="247" y="988.792">每行数据的隐藏字段</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="315" x="436" y="970.4951">DB_TRX_ID：最后插入或更新行的最新事务的标识</text><path d="M383,983.9453 L393,983.9453 C408,983.9453 408,965.6484 423,965.6484 L433,965.6484 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="437" x="436" y="988.792">DB_ROLL_PTR：指向写入 rollback segment 中的 undo log record</text><path d="M383,983.9453 L393,983.9453 C408,983.9453 408,983.9453 423,983.9453 L433,983.9453 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="296" x="436" y="1007.0889">DB_ROW_ID：当新行插入后单调递增的 row id</text><path d="M383,983.9453 L393,983.9453 C408,983.9453 408,1002.2422 423,1002.2422 L433,1002.2422 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M187,983.9453 L197,983.9453 C212,983.9453 212,983.9453 227,983.9453 L237,983.9453 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M76,935.9063 L86,935.9063 C101,935.9063 101,983.9453 116,983.9453 L126,983.9453 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#ffl6dfc65c1vi)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="48" x="126" y="1022.0938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="136" y="1045.0889">幻读</text><path d="M76,935.9063 L86,935.9063 C101,935.9063 101,1040.2422 116,1040.2422 L126,1040.2422 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#ffl6dfc65c1vi)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="34" x="126" y="1214.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="14" x="136" y="1237.7217">锁</text><rect fill="#FEFECE" filter="url(#ffl6dfc65c1vi)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="210" x="210" y="1078.3906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="190" x="220" y="1101.3857">Shared and Exclusive Locks</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="189" x="473" y="1092.2373">Shared：允许事务持有锁读行</text><path d="M420,1096.5391 L430,1096.5391 C445,1096.5391 445,1087.3906 460,1087.3906 L470,1087.3906 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="259" x="473" y="1110.5342">Exclusive：允许事务持有锁更新或删除行</text><path d="M420,1096.5391 L430,1096.5391 C445,1096.5391 445,1105.6875 460,1105.6875 L470,1105.6875 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M160,1232.875 L170,1232.875 C185,1232.875 185,1096.5391 200,1096.5391 L210,1096.5391 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#ffl6dfc65c1vi)" height="85.1875" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="363" x="210" y="1134.6875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="224" y="1157.6826"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="343" x="220" y="1173.9795">Intention Locks：允许多粒度锁（行锁，表锁共存）。</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="322" x="220" y="1190.2764">表级锁表示事务将要对表中的某行请求什么类型的锁</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="224" y="1206.5732"/><path d="M160,1232.875 L170,1232.875 C185,1232.875 185,1177.2813 200,1177.2813 L210,1177.2813 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#ffl6dfc65c1vi)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="559" x="210" y="1239.875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="122" x="220" y="1262.8701">Record Locks：在</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="101" x="346" y="1262.8701">index record</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="308" x="451" y="1262.8701">上的锁。即使没有索引，也会创建隐藏聚簇索引。</text><path d="M160,1232.875 L170,1232.875 C185,1232.875 185,1258.0234 200,1258.0234 L210,1258.0234 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#ffl6dfc65c1vi)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="278" x="210" y="1296.1719"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="258" x="220" y="1319.167">Gap Locks：锁 index records 的间隙。</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="322" x="541" y="1310.0186">使用唯一索引查找唯一行的语句不需要，直接锁行；</text><path d="M488,1314.3203 L498,1314.3203 C513,1314.3203 513,1305.1719 528,1305.1719 L538,1305.1719 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="280" x="541" y="1328.3154">如果列没有索引或唯一索引，锁前面的间隙。</text><path d="M488,1314.3203 L498,1314.3203 C513,1314.3203 513,1323.4688 528,1323.4688 L538,1323.4688 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M160,1232.875 L170,1232.875 C185,1232.875 185,1314.3203 200,1314.3203 L210,1314.3203 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="445" x="213" y="1356.4639">Next-Key Locks：Record Lock + Gap Lock(index record 前的间隙)</text><path d="M160,1232.875 L170,1232.875 C185,1232.875 185,1351.6172 200,1351.6172 L210,1351.6172 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="336" x="213" y="1374.7607">Insert Intention Locks：插入数据时设置的 gap lock</text><path d="M160,1232.875 L170,1232.875 C185,1232.875 185,1369.9141 200,1369.9141 L210,1369.9141 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="213" y="1393.0576">AUTO-INC Locks</text><path d="M160,1232.875 L170,1232.875 C185,1232.875 185,1388.2109 200,1388.2109 L210,1388.2109 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M76,935.9063 L86,935.9063 C101,935.9063 101,1232.875 116,1232.875 L126,1232.875 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#ffl6dfc65c1vi)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="68" x="126" y="1527.6953"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48" x="136" y="1550.6904">explain</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="12" x="247" y="1411.3545">id</text><path d="M194,1545.8438 L204,1545.8438 C219,1545.8438 219,1406.5078 234,1406.5078 L244,1406.5078 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#ffl6dfc65c1vi)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="99" x="244" y="1425.6563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="254" y="1448.6514">select_type</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="55" x="396" y="1412.0576">SIMPLE</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="130" x="451" y="1412.0576">: 无 union 或 子查询</text><path d="M343,1443.8047 L353,1443.8047 C368,1443.8047 368,1407.2109 383,1407.2109 L393,1407.2109 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="68" x="396" y="1430.3545">PRIMARY</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37" x="464" y="1430.3545">: 最外</text><path d="M343,1443.8047 L353,1443.8047 C368,1443.8047 368,1425.5078 383,1425.5078 L393,1425.5078 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="83" x="396" y="1448.6514">SUBQUERY</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="164" x="479" y="1448.6514">: 子查询中第一个 SELECT</text><path d="M343,1443.8047 L353,1443.8047 C368,1443.8047 368,1443.8047 383,1443.8047 L393,1443.8047 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="65" x="396" y="1466.9482">DERIVED</text><path d="M343,1443.8047 L353,1443.8047 C368,1443.8047 368,1462.1016 383,1462.1016 L393,1462.1016 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="112" x="396" y="1485.2451">MATERIALIZED</text><path d="M343,1443.8047 L353,1443.8047 C368,1443.8047 368,1480.3984 383,1480.3984 L393,1480.3984 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M194,1545.8438 L204,1545.8438 C219,1545.8438 219,1443.8047 234,1443.8047 L244,1443.8047 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#ffl6dfc65c1vi)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="50" x="244" y="1481.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30" x="254" y="1504.9482">type</text><path d="M194,1545.8438 L204,1545.8438 C219,1545.8438 219,1500.1016 234,1500.1016 L244,1500.1016 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#ffl6dfc65c1vi)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="54" x="244" y="1538.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="34" x="254" y="1561.2451">Extra</text><path d="M194,1545.8438 L204,1545.8438 C219,1545.8438 219,1556.3984 234,1556.3984 L244,1556.3984 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97" x="247" y="1598.542">possible_keys</text><path d="M194,1545.8438 L204,1545.8438 C219,1545.8438 219,1593.6953 234,1593.6953 L244,1593.6953 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="24" x="247" y="1616.8389">key</text><path d="M194,1545.8438 L204,1545.8438 C219,1545.8438 219,1611.9922 234,1611.9922 L244,1611.9922 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="177" x="247" y="1635.1357">key_len: 使用的 key 的长度</text><path d="M194,1545.8438 L204,1545.8438 C219,1545.8438 219,1630.2891 234,1630.2891 L244,1630.2891 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="33" x="247" y="1653.4326">rows</text><path d="M194,1545.8438 L204,1545.8438 C219,1545.8438 219,1648.5859 234,1648.5859 L244,1648.5859 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38" x="247" y="1671.7295">filterd</text><path d="M194,1545.8438 L204,1545.8438 C219,1545.8438 219,1666.8828 234,1666.8828 L244,1666.8828 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="34" x="247" y="1690.0264">extra</text><path d="M194,1545.8438 L204,1545.8438 C219,1545.8438 219,1685.1797 234,1685.1797 L244,1685.1797 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M76,935.9063 L86,935.9063 C101,935.9063 101,1545.8438 116,1545.8438 L126,1545.8438 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#ffl6dfc65c1vi)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="48" x="126" y="1722.625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="136" y="1745.6201">索引</text><rect fill="#FEFECE" filter="url(#ffl6dfc65c1vi)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="48" x="224" y="1704.3281"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="234" y="1727.3232">种类</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="325" y="1709.0264">聚簇索引</text><path d="M272,1722.4766 L282,1722.4766 C297,1722.4766 297,1704.1797 312,1704.1797 L322,1704.1797 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="325" y="1727.3232">二级索引</text><path d="M272,1722.4766 L282,1722.4766 C297,1722.4766 297,1722.4766 312,1722.4766 L322,1722.4766 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="325" y="1745.6201">覆盖索引</text><path d="M272,1722.4766 L282,1722.4766 C297,1722.4766 297,1740.7734 312,1740.7734 L322,1740.7734 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M174,1740.7734 L184,1740.7734 C199,1740.7734 199,1722.4766 214,1722.4766 L224,1722.4766 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="168" x="227" y="1764.6201">自动生成的主键有什么问题</text><path d="M174,1740.7734 L184,1740.7734 C199,1740.7734 199,1759.7734 214,1759.7734 L224,1759.7734 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="227" y="1782.917">什么情况索引失效</text><path d="M174,1740.7734 L184,1740.7734 C199,1740.7734 199,1778.0703 214,1778.0703 L224,1778.0703 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M76,935.9063 L86,935.9063 C101,935.9063 101,1740.7734 116,1740.7734 L126,1740.7734 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#ffl6dfc65c1vi)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="48" x="126" y="1806.3672"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="136" y="1829.3623">运维</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="238" x="227" y="1801.2139">一张大表怎么更改表的数据结构，字段</text><path d="M174,1824.5156 L184,1824.5156 C199,1824.5156 199,1796.3672 214,1796.3672 L224,1796.3672 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#ffl6dfc65c1vi)" height="36.2969" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="144" x="224" y="1815.5156"/><a href="https://segmentfault.com/a/1190000023810042" target="_top" title="https://segmentfault.com/a/1190000023810042" xlink:actuate="onRequest" xlink:href="https://segmentfault.com/a/1190000023810042" xlink:show="new" xlink:title="https://segmentfault.com/a/1190000023810042" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="124" x="234" y="1838.5107">自增id用完了怎么办</text></a><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="56" x="421" y="1829.3623">自增主键</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="170" x="477" y="1829.3623">，主键冲突，id 仍为最大志</text><path d="M368,1833.6641 L378,1833.6641 C393,1833.6641 393,1824.5156 408,1824.5156 L418,1824.5156 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="254" x="421" y="1847.6592">指定 row_id(6 byte) 为主键(共享)，取 0</text><path d="M368,1833.6641 L378,1833.6641 C393,1833.6641 393,1842.8125 408,1842.8125 L418,1842.8125 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M174,1824.5156 L184,1824.5156 C199,1824.5156 199,1833.6641 214,1833.6641 L224,1833.6641 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><path d="M76,935.9063 L86,935.9063 C101,935.9063 101,1824.5156 116,1824.5156 L126,1824.5156 " fill="none" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[5da09da09db341b5d84b8808396db9f2]
@startmindmap MySQL 脑图


* MySQL

** Log [[https://zhuanlan.zhihu.com/p/58011817 MySQL日志分类及简介]]
***_ 错误日志
***_ 查询日志
***_ 慢查询日志 *
*** 事务日志
****_ 重做日志 (redo log)
****_ 回滚日志 (undo log)
***_ 二进制日志
***_ 中继日志

** InnoDB
***: 
结构
[[https://zhuanlan.zhihu.com/p/235458760 深入剖析InnoDB]] 
[[https://draveness.me/mysql-innodb/ 『浅入浅出』InnoDB]]
;
**** 内存中
***** 缓冲池(Buffer Pool)
******_ 缓存访问的索引和表数据
******_ 常用数据内存访问
******_ 80%+ 内存占用
******_ 划分为包含多行的链表连接的页，LRU 淘汰
***** 写缓冲区(Change Buffer)
******_ 内存：占用 buffer pool 的内存；硬盘渣弄 system tablespace
******_ 缓存不在 buffer pool 中的**二级索引**的修改
******_ 当其他读将页加载到 buffer pool 中合并，减少随机 IO
******_ 当系统空闲或者 slow shutdown 周期性将更新的索引写盘
***** 日志缓冲区(log Buffer)
******_ 持有写入硬盘的 log 文件的数据
******_ 周期性刷盘
******_ 更大可以使运行大事务不需要在提交事务前写入 redo log 数据到硬盘
*****_ 自适应 Hash 索引
**** 硬盘中
***** Double Write Buffer
******_ 事物原子性 -> **磁盘 I/O 原子性**。Page 16KB。**Page 的原子性**？
******_ buffer pool 写入硬盘前写到这里
******_ 在故障恢复中可以在这里找到一份 page 的好的 copy
******_ 虽然数据写入两次(doublewrite buffer + page),但是写到 dw 是大块写入，一次 fsync()
***** Redo Log
******_ 故障恢复中修正未完成的事务的数据
******_ SQL 语句或低级 API 调用产生的更改表数据的请求进行编码
******_ ib_logfile0 & ib_logfile1
***** Undo Log
******_ 与单个读写事务相关联的撤消日志记录的集合
******_ 包含有关如何撤消事务对聚集索引记录的最新更改的信息


** ACID
*** Atomicity 中止（abort）
****_ 能够在错误时中止事务，丢弃该事务进行的所有写入变更的能力
****_ 事物

*** Consistency 不变量（invariants）
****_ doublewrite buffer

*** Isolation
****_ 锁
**** 事物隔离级别
' *****_ 读已提交（Read Committed）

*** Durability
****_ doublewrite buffer
****_ 运维

** 隔离级别
***_  READ UNCOMMITTED
***  READ COMMITTED
****_ 在同个事务中的每个一致性读设置及读其自己的新鲜的 snapshot
****_ lock r & u & d: 只锁索引记录而没有前面的 gap，可以任意插入记录
***  REPEATABLE READ
****_ 同个事物的**一致性读**读取第一个读建立的 snapshot
**** locking read & update & delete
*****_ 查询使用唯一索引只锁找到的 index record
*****_ 其他情况锁扫描到的索引范围

***_  SERIALIZABLE
** MVCC
*** 每行数据的隐藏字段
****_ DB_TRX_ID：最后插入或更新行的最新事务的标识
****_ DB_ROLL_PTR：指向写入 rollback segment 中的 undo log record
****_ DB_ROW_ID：当新行插入后单调递增的 row id
** 幻读


** 锁
*** Shared and Exclusive Locks
****_ Shared：允许事务持有锁读行
****_ Exclusive：允许事务持有锁更新或删除行
***: 
Intention Locks：允许多粒度锁（行锁，表锁共存）。
表级锁表示事务将要对表中的某行请求什么类型的锁
;
*** Record Locks：在 **index record** 上的锁。即使没有索引，也会创建隐藏聚簇索引。
*** Gap Locks：锁 index records 的间隙。
****_ 使用唯一索引查找唯一行的语句不需要，直接锁行；
****_ 如果列没有索引或唯一索引，锁前面的间隙。
***_ Next-Key Locks：Record Lock + Gap Lock(index record 前的间隙)
***_ Insert Intention Locks：插入数据时设置的 gap lock
***_ AUTO-INC Locks

** explain
***_ id
*** select_type
****_ **SIMPLE**: 无 union 或 子查询
****_ **PRIMARY**: 最外
****_ **SUBQUERY**: 子查询中第一个 SELECT
****_ **DERIVED**
****_ **MATERIALIZED**

*** type
*** Extra
***_ possible_keys
***_ key 
***_ key_len: 使用的 key 的长度
***_ rows
***_ filterd
***_ extra


** 索引
*** 种类
****_ 聚簇索引
****_ 二级索引
****_ 覆盖索引
***_ 自动生成的主键有什么问题
***_ 什么情况索引失效

** 运维
***_ 一张大表怎么更改表的数据结构，字段
*** [[https://segmentfault.com/a/1190000023810042 自增id用完了怎么办]]
****_ **自增主键**，主键冲突，id 仍为最大志
****_ 指定 row_id(6 byte) 为主键(共享)，取 0

@endmindmap

@startmindmap MySQL 脑图


* MySQL

** Log [[https://zhuanlan.zhihu.com/p/58011817 MySQL日志分类及简介]]
***_ 错误日志
***_ 查询日志
***_ 慢查询日志 *
*** 事务日志
****_ 重做日志 (redo log)
****_ 回滚日志 (undo log)
***_ 二进制日志
***_ 中继日志

** InnoDB
***: 
结构
[[https://zhuanlan.zhihu.com/p/235458760 深入剖析InnoDB]] 
[[https://draveness.me/mysql-innodb/ 『浅入浅出』InnoDB]]
;
**** 内存中
***** 缓冲池(Buffer Pool)
******_ 缓存访问的索引和表数据
******_ 常用数据内存访问
******_ 80%+ 内存占用
******_ 划分为包含多行的链表连接的页，LRU 淘汰
***** 写缓冲区(Change Buffer)
******_ 内存：占用 buffer pool 的内存；硬盘渣弄 system tablespace
******_ 缓存不在 buffer pool 中的**二级索引**的修改
******_ 当其他读将页加载到 buffer pool 中合并，减少随机 IO
******_ 当系统空闲或者 slow shutdown 周期性将更新的索引写盘
***** 日志缓冲区(log Buffer)
******_ 持有写入硬盘的 log 文件的数据
******_ 周期性刷盘
******_ 更大可以使运行大事务不需要在提交事务前写入 redo log 数据到硬盘
*****_ 自适应 Hash 索引
**** 硬盘中
***** Double Write Buffer
******_ 事物原子性 -> **磁盘 I/O 原子性**。Page 16KB。**Page 的原子性**？
******_ buffer pool 写入硬盘前写到这里
******_ 在故障恢复中可以在这里找到一份 page 的好的 copy
******_ 虽然数据写入两次(doublewrite buffer + page),但是写到 dw 是大块写入，一次 fsync()
***** Redo Log
******_ 故障恢复中修正未完成的事务的数据
******_ SQL 语句或低级 API 调用产生的更改表数据的请求进行编码
******_ ib_logfile0 & ib_logfile1
***** Undo Log
******_ 与单个读写事务相关联的撤消日志记录的集合
******_ 包含有关如何撤消事务对聚集索引记录的最新更改的信息


** ACID
*** Atomicity 中止（abort）
****_ 能够在错误时中止事务，丢弃该事务进行的所有写入变更的能力
****_ 事物

*** Consistency 不变量（invariants）
****_ doublewrite buffer

*** Isolation
****_ 锁
**** 事物隔离级别

*** Durability
****_ doublewrite buffer
****_ 运维

** 隔离级别
***_  READ UNCOMMITTED
***  READ COMMITTED
****_ 在同个事务中的每个一致性读设置及读其自己的新鲜的 snapshot
****_ lock r & u & d: 只锁索引记录而没有前面的 gap，可以任意插入记录
***  REPEATABLE READ
****_ 同个事物的**一致性读**读取第一个读建立的 snapshot
**** locking read & update & delete
*****_ 查询使用唯一索引只锁找到的 index record
*****_ 其他情况锁扫描到的索引范围

***_  SERIALIZABLE
** MVCC
*** 每行数据的隐藏字段
****_ DB_TRX_ID：最后插入或更新行的最新事务的标识
****_ DB_ROLL_PTR：指向写入 rollback segment 中的 undo log record
****_ DB_ROW_ID：当新行插入后单调递增的 row id
** 幻读


** 锁
*** Shared and Exclusive Locks
****_ Shared：允许事务持有锁读行
****_ Exclusive：允许事务持有锁更新或删除行
***: 
Intention Locks：允许多粒度锁（行锁，表锁共存）。
表级锁表示事务将要对表中的某行请求什么类型的锁
;
*** Record Locks：在 **index record** 上的锁。即使没有索引，也会创建隐藏聚簇索引。
*** Gap Locks：锁 index records 的间隙。
****_ 使用唯一索引查找唯一行的语句不需要，直接锁行；
****_ 如果列没有索引或唯一索引，锁前面的间隙。
***_ Next-Key Locks：Record Lock + Gap Lock(index record 前的间隙)
***_ Insert Intention Locks：插入数据时设置的 gap lock
***_ AUTO-INC Locks

** explain
***_ id
*** select_type
****_ **SIMPLE**: 无 union 或 子查询
****_ **PRIMARY**: 最外
****_ **SUBQUERY**: 子查询中第一个 SELECT
****_ **DERIVED**
****_ **MATERIALIZED**

*** type
*** Extra
***_ possible_keys
***_ key 
***_ key_len: 使用的 key 的长度
***_ rows
***_ filterd
***_ extra


** 索引
*** 种类
****_ 聚簇索引
****_ 二级索引
****_ 覆盖索引
***_ 自动生成的主键有什么问题
***_ 什么情况索引失效

** 运维
***_ 一张大表怎么更改表的数据结构，字段
*** [[https://segmentfault.com/a/1190000023810042 自增id用完了怎么办]]
****_ **自增主键**，主键冲突，id 仍为最大志
****_ 指定 row_id(6 byte) 为主键(共享)，取 0

@endmindmap

PlantUML version 1.2021.5(Sun Apr 25 11:20:28 UTC 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>